angular.module('app').controller('PostsCtrl', function ($scope, PostsSvc, $window, $document){	/* emit broadcast for current pageId */	$scope.$emit('pagechange', $scope.pageId.post);	$scope.posts = [];/* 강아지 GET때 필요했엇음.	$scope.$on('refetch', function(_, obj){		$scope.requestFetch();	});*/		/* as server tells there was new post, lets re-load list data */	$scope.$on('ws:new_post', function(_, post){		$scope.requestFetch();	});	/* move to post's location */	$scope.moveToLoc = function(id){		var post = ($scope.posts[id]);		var location = angular.fromJson(post.location);		var googleLoc = new google.maps.LatLng(location.lat, location.lon);		$scope.map.panTo(googleLoc);		$scope.map.setZoom(16);		/* using angular-scroll to move to the top smoothly */		var top = 0;    	var duration = 480;    	$document.scrollTop(top, duration).then(function() {     		 console && console.log('You just scrolled to the top!');    	});	};	$scope.addPost = function() {		/* get autocompleted place and reset(set to undefined) */		var place = $scope.postplace;		var location = $scope.postLocation;		var locationJSON = JSON.stringify(location);		console.log("POST location:", locationJSON);		console.log("POST place:", place);		PostsSvc.create(		{			body    : $scope.content,			location: locationJSON,			place   : place		})		.success(function(post){			/* manually reload markers 			using maptypeid since its most least used event, - kind of hacky way to do it			*/			google.maps.event.trigger($scope.map, 'maptypeid_changed');			$scope.posts.unshift(post);			console.log("post has been postsed. ready for delete");			/* front end side list post remove */			var frontEndPostRemove = function(){ 				for (var i = 0; i < $scope.posts.length; ++i){				if (post._id == $scope.posts[i]._id)					$scope.posts.splice(i, 1);				}			};			setTimeout(frontEndPostRemove, post.lifespan);			/* reset input forms */			$scope.content  = null;		})		.error(function(data, status){			swal("Post failed", "Please complete the from correctly", "error");		});	};	/* as server tells there was new post, lets re-load list data */	$scope.requestFetch = function() {		PostsSvc.fetch()		.success(function(posts){			console.log('Posts have been loaded successfully for front page');			$scope.posts = posts;		});	};	$scope.requestFetch();});