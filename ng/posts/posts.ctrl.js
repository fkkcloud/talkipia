angular.module('app').controller('PostsCtrl', function ($rootScope, $scope, ConfigSvc, PostsSvc, UtilSvc, $window, $document, $timeout){	/* emit broadcast for current pageId */	$scope.$emit('set:pagechange', $scope.pageId.post);	$scope.posts = [];	/* as server tells there was new post, lets re-load list data */	$scope.$on('ws:new_post', function(_, post){		$scope.requestFetch();	});	$scope.addPost = function() {		/* check if the post content is there - only for WEB for enter button to post */		if (!$scope.content){			/*console.log("User attempted to post with 0 words.")*/			return;		}		/* get autocompleted place and reset(set to undefined) */		var place    = $scope.postplace;		var location = $scope.postLocation;		var local_status;		var postLocationFromUserLocation = UtilSvc.getDistanceFromLatLonInKm(location.lat, location.lon, $scope.userLocation.lat, $scope.userLocation.lon);		/* if less than 3km */		if (postLocationFromUserLocation < 3){			local_status = true;		}		else {			local_status = false;		}				var locationJSON = JSON.stringify(location);		var relativeLifeSpan;		if ($scope.timevalue <= ConfigSvc.maxInstantLifeSpan){			var charLen = $scope.content.length;			if (charLen < 5)			{				relativeLifeSpan = 4000;			}			else			{				relativeLifeSpan = charLen * UtilSvc.mapRange(charLen, 5, 20, 700, 400);			}		}		else {			relativeLifeSpan = $scope.timevalue;		}		PostsSvc.create(		{			body    :  $scope.content,			location:  locationJSON,			place   :  place,			guid    :  $scope.guid,			guidtgt :  $scope.guidtgt,			lifespan:  relativeLifeSpan,			islocal :  local_status,		})		.success(function(post){								/* reset input forms */			$scope.content  = null;		})		.error(function(data, status){			swal("Post failed", "Please complete the from correctly", "error");		});	};	/* as server tells there was new post, lets re-load list data */	$scope.requestFetch = function() {		PostsSvc.fetch()		.success(function(posts){			/*console.log('Got Posts:', posts); */			$scope.posts = posts;		});	};	/* update guid of post */	$scope.updateGuidtgt = function(myguid, guidtgt) {		var updates = {			guid    : myguid,			guidtgt : guidtgt		};		/*console.log("udpate to post guidtgt:", updates)*/		PostsSvc.updateGuidtgt(updates);	}	/*$scope.requestFetch();*/});