angular.module("app",["ngRoute","duScroll"]),angular.module("app").controller("ApplicationCtrl",["$rootScope","$scope","$window","$http",function(o,e,t,n){e.pageId={post:0},e.navCollapsed=!0,e.collapse=function(){e.navCollapsed=!0},e.$on("ws:new_post",function(o,t){google.maps.event.trigger(e.map,"maptypeid_changed")}),e.moveToCurrentLocation=function(){function o(o){if(e.currentPageId==e.pageId.post){var t=o.coords;window.localStorage.latitude=t.latitude,window.localStorage.longitude=t.longitude;var n=new google.maps.LatLng(t.latitude,t.longitude);google.maps.event.trigger(e.map,"heading_changed",n),e.map.panTo(n),e.map.setZoom(15)}}function t(o){console.warn("ERROR("+o.code+"): "+o.message)}navigator.geolocation.getCurrentPosition(o,t),swal({title:"",text:"Moving to current location..",timer:1500,showConfirmButton:!1})},e.$on("pagechange",function(o,t){e.currentPageId=t}),e.$on("loc",function(o,t){console.log("IN:",t);var n=t.lat(),a=t.lng();e.postLocation={lat:n,lon:a},console.log("SAVED:",e.postLocation)}),e.$on("place",function(o,t){e.$apply(function(){e.postplace=t,console.log("SAVED:",e.postplace)})}),e.$on("mapInit",function(o,t){e.map=t,google.maps.event.trigger(e.map,"center_changed")})}]),angular.module("app").config(["$routeProvider",function(o){o.when("/",{controller:"PostsCtrl",templateUrl:"/templates/posts.html"}).otherwise({redirectTo:"/"})}]),angular.module("app").service("UtilSvc",function(){var o=this;o.deg2rad=function(o){return o*(Math.PI/180)},o.getDistanceFromLatLonInKm=function(e,t,n,a){var l=6371,i=o.deg2rad(n-e),s=o.deg2rad(a-t),c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(o.deg2rad(e))*Math.cos(o.deg2rad(n))*Math.sin(s/2)*Math.sin(s/2),r=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),g=l*r;return g}}),angular.module("app").directive("appMap",["PostsSvc","UtilSvc","$compile","$timeout",function(o,e,t,n){var a=function(e,a,l){function i(o){for(var e,t=0;e=M[t];t++)e.setMap(null);M=[];var e=new google.maps.Marker({position:o,map:h,icon:$});M.push(e)}function s(){for(var o,e=0;o=M[e];e++)o.setMap(null);M=[]}function c(o){var t=new google.maps.Geocoder;e.$emit("loc",o),i(o),t.geocode({latLng:o},function(o,t){try{e.$emit("place",o[1].formatted_address)}catch(n){console.log(n),swal("","Location does not exists"),e.$emit("place","Location does not exists")}})}function r(){o.fetch().success(function(o){for(var n=0;n<o.length;n++){for(var a,l=o[n],i=0;a=I[i];i++)if(l._id==a.post._id){l=null;break}if(l&&l.hasOwnProperty("location")){var s=angular.fromJson(l.location),c=new google.maps.LatLng(s.lat,s.lon);if(c.lat()<S.lat()&&c.lat()>L.lat()&&c.lng()<L.lng()&&c.lng()>S.lng()){var r={position:c,map:h,title:"Bubble",icon:P},a=new google.maps.Marker(r);setTimeout(function(o,e){return function(){o.setMap(null);for(var t,n=0;t=I[n];n++)e._id==t.post._id&&I.splice(n,1)}}(a,l),l.lifespan),I.push({marker:a,post:l});var g=e,p=g.$new(!0),u=function(o,e,n,a){return function(){var l={pixelOffset:new google.maps.Size(-41.5,10)},i=new google.maps.InfoWindow(l),s="<div map-msg></div>",c=t(s)(e);e.msg=n,e.postlife=a,i.setContent(c[0]),i.open(h,o)}}(a,p,l.body,l.lifespan);u()}}}})}function g(){var o=document.getElementById("pac-input"),e=document.getElementById("btn-curr");h.controls[google.maps.ControlPosition.TOP_LEFT].push(o),h.controls[google.maps.ControlPosition.TOP_RIGHT].push(e);var t=new google.maps.places.SearchBox(o);google.maps.event.addListener(t,"places_changed",function(){var o=t.getPlaces();if(0!=o.length){var e=o[0];c(e.geometry.location),window.localStorage.latitude=e.geometry.location.latitude,window.localStorage.longitude=e.geometry.location.longitude,h.panTo(e.geometry.location),h.setZoom(16)}})}function p(){google.maps.event.addListener(h,"click",function(o){c(o.latLng)})}function u(){google.maps.event.addListener(h,"heading_changed",function(o){c(o)})}function d(){google.maps.event.addListener(h,"center_changed",function(){window.localStorage.latitude=h.getCenter().lat(),window.localStorage.longitude=h.getCenter().lng(),f()})}function m(){google.maps.event.addListener(h,"dragend",function(){r()})}function f(){var o=h.getBounds(),e=o.getNorthEast(),t=o.getSouthWest();S=new google.maps.LatLng(e.lat(),t.lng()),L=new google.maps.LatLng(t.lat(),e.lng())}function w(){google.maps.event.addListener(h,"maptypeid_changed",function(){s(),r()})}function v(){void 0===h&&(h=new google.maps.Map(a[0],_)),w(),e.$emit("mapInit",h),p(),g(),d(),u(),m(),r(),n(function(){f()},800)}var h,S,L,P={url:"https://catchme.ifyoucan.com/images/pictures/IYC_Icons/IYC_Location_Icon_Small.png",size:new google.maps.Size(100,100),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(17,25)},$={url:"http://www.clker.com/cliparts/U/P/j/M/I/i/x-mark-yellow-md.png",size:new google.maps.Size(100,100),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};console.log("window.localStorage.latitude ",window.localStorage.latitude);var y=new google.maps.LatLng(34.05,-118.24);isNaN(window.localStorage.latitude)||isNaN(window.localStorage.longitude)||(y=new google.maps.LatLng(window.localStorage.latitude,window.localStorage.longitude)),console.log("window.localStorage.latitude ",window.localStorage.latitude),console.log(y);var _={center:y,zoom:15,MapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,streetViewControl:!1,mapTypeControl:!1,panControl:!1},M=[],I=[];v()};return{restrict:"A",template:'<div id="map-canvas"></div>',replace:!0,link:a}}]),angular.module("app").directive("mapMsg",function(){return{restrict:"A",templateUrl:"./templates/window.html",link:function(o,e){var t=o.postlife+"ms";angular.element(document).ready(function(){$("div div .postlifebar").css("animation-duration",t),console.log("Jquery called :"+t+" and msg:"+o.msg)})}}}),angular.module("app").controller("PostsCtrl",["$scope","PostsSvc","$window","$document",function(o,e,t,n){o.$emit("pagechange",o.pageId.post),o.posts=[],o.$on("ws:new_post",function(e,t){o.requestFetch()}),o.moveToLoc=function(e){var t=o.posts[e],a=angular.fromJson(t.location),l=new google.maps.LatLng(a.lat,a.lon);o.map.panTo(l),o.map.setZoom(16);var i=0,s=480;n.scrollTop(i,s).then(function(){console&&console.log("You just scrolled to the top!")})},o.addPost=function(){var t=o.postplace,n=o.postLocation,a=JSON.stringify(n);console.log("POST location:",a),console.log("POST place:",t),e.create({body:o.content,location:a,place:t}).success(function(e){google.maps.event.trigger(o.map,"maptypeid_changed"),o.posts.unshift(e),console.log("post has been postsed. ready for delete");var t=function(){for(var t=0;t<o.posts.length;++t)e._id==o.posts[t]._id&&o.posts.splice(t,1)};setTimeout(t,e.lifespan),o.content=null}).error(function(o,e){swal("Post failed","Please complete the from correctly","error")})},o.requestFetch=function(){e.fetch().success(function(e){console.log("Posts have been loaded successfully for front page"),o.posts=e})},o.requestFetch()}]),angular.module("app").service("PostsSvc",["$http",function(o){this.fetch=function(){return o.get("/api/posts")},this.create=function(e){return o.post("/api/posts",e)},this.remove=function(e){return console.log("deleting posting"),console.log("post._id:",e._id),o.put("/api/posts",e)}}]),angular.module("app").run(["$rootScope","$timeout",function(o,e){var t,n=document.location.hostname,a="192.168.0.4";t="localhost"==n||n==a?"ws://192.168.0.4:5000":"wss://frozen-badlands-8649.herokuapp.com";var l=new WebSocket(t),i=function(){l=new WebSocket(t)};l.onopen=function(){console.log("WebSocket connected")},l.onclose=function(){console.log("WebSocket closed. Reconecting..."),e(i,1e5)},l.onmessage=function(e){console.log(e);var t=JSON.parse(e.data);o.$broadcast("ws:"+t.type,t.data)}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1dGlsLnN2Yy5qcyIsIm1hcHMvbWFwLmRpcmVjdGl2ZS5qcyIsIm1hcHMvbXNnLmRpcmVjdGl2ZS5qcyIsInBvc3RzL3Bvc3RzLmN0cmwuanMiLCJwb3N0cy9wb3N0cy5zdmMuanMiLCJhcHAuanMiLCJzb2NrZXRzL3dlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcm9vdFNjb3BlIiwiJHNjb3BlIiwiJHdpbmRvdyIsIiRodHRwIiwicGFnZUlkIiwicG9zdCIsIm5hdkNvbGxhcHNlZCIsImNvbGxhcHNlIiwiJG9uIiwiXyIsImdvb2dsZSIsIm1hcHMiLCJldmVudCIsInRyaWdnZXIiLCJtYXAiLCJtb3ZlVG9DdXJyZW50TG9jYXRpb24iLCJnZXRDdXJyTG9jU3VjY2VzcyIsInBvcyIsImN1cnJlbnRQYWdlSWQiLCJjcmQiLCJjb29yZHMiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImdvb2dsZUxvYyIsIkxhdExuZyIsInBhblRvIiwic2V0Wm9vbSIsImdldEN1cnJMb2NFcnJvciIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiY29kZSIsIm1lc3NhZ2UiLCJuYXZpZ2F0b3IiLCJnZW9sb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsInN3YWwiLCJ0aXRsZSIsInRleHQiLCJ0aW1lciIsInNob3dDb25maXJtQnV0dG9uIiwibG9jYXRpb24iLCJsb2ciLCJsYXQiLCJsb24iLCJsbmciLCJwb3N0TG9jYXRpb24iLCJwbGFjZSIsIiRhcHBseSIsInBvc3RwbGFjZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInNlcnZpY2UiLCJzdmMiLCJ0aGlzIiwiZGVnMnJhZCIsImRlZyIsIk1hdGgiLCJQSSIsImdldERpc3RhbmNlRnJvbUxhdExvbkluS20iLCJsYXQxIiwibG9uMSIsImxhdDIiLCJsb24yIiwiUiIsImRMYXQiLCJkTG9uIiwiYSIsInNpbiIsImNvcyIsImMiLCJhdGFuMiIsInNxcnQiLCJkIiwiZGlyZWN0aXZlIiwiUG9zdHNTdmMiLCJVdGlsU3ZjIiwiJGNvbXBpbGUiLCIkdGltZW91dCIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImRyYXdIZWxwZXJNYXJrZXIiLCJtYXJrZXIiLCJpIiwiaGVscGVyTWFya2VycyIsInNldE1hcCIsIk1hcmtlciIsInBvc2l0aW9uIiwiaWNvbiIsImltYWdlVGFyZ2V0IiwicHVzaCIsInJlbW92ZUhlbHBlck1hcmtlciIsImRyYXdBbmRTZXRQbGFjZSIsImdlb2NvZGVyIiwiR2VvY29kZXIiLCIkZW1pdCIsImdlb2NvZGUiLCJsYXRMbmciLCJyZXN1bHRzIiwic3RhdHVzIiwiZm9ybWF0dGVkX2FkZHJlc3MiLCJ1cGRhdGVNYXAiLCJmZXRjaCIsInN1Y2Nlc3MiLCJwb3N0cyIsImxlbmd0aCIsImoiLCJtYXJrZXJzIiwiX2lkIiwiaGFzT3duUHJvcGVydHkiLCJmcm9tSnNvbiIsImN1cnJlbnRfbWFwX253IiwiY3VycmVudF9tYXBfc2UiLCJtYXJrZXJPcHRpb25zIiwiaW1hZ2VQb3N0Iiwic2V0VGltZW91dCIsIm9sZF9tYXJrZXIiLCJvbGRfcG9zdCIsImsiLCJzcGxpY2UiLCJsaWZlc3BhbiIsInBhcmVudCIsImNoaWxkIiwiJG5ldyIsIm9wZW5JbmZvV2luZG93IiwicG9zdG1zZyIsInBvc3RsaWZlIiwiaW5mb1dpbmRvd09wdGlvbnMiLCJwaXhlbE9mZnNldCIsIlNpemUiLCJpbmZvV2luZG93IiwiSW5mb1dpbmRvdyIsImNvbnRlbnQiLCJjb21waWxlZCIsIm1zZyIsInNldENvbnRlbnQiLCJvcGVuIiwiYm9keSIsInNldFNlYXJjaEJveCIsImlucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN1cnJMb2NCdG4iLCJjb250cm9scyIsIkNvbnRyb2xQb3NpdGlvbiIsIlRPUF9MRUZUIiwiVE9QX1JJR0hUIiwic2VhcmNoQm94IiwicGxhY2VzIiwiU2VhcmNoQm94IiwiYWRkTGlzdGVuZXIiLCJnZXRQbGFjZXMiLCJnZW9tZXRyeSIsInNldENsaWNrTWFwIiwic2V0TW92ZVRvQ3VycmVudExvY2F0aW9uIiwic2V0Q2VudGVyQ2hhbmdlZCIsImdldENlbnRlciIsInVwZGF0ZUJvdW5kcyIsInNldE1hcERyYWdFbmQiLCJib3VuZHMiLCJnZXRCb3VuZHMiLCJuZSIsImdldE5vcnRoRWFzdCIsInN3IiwiZ2V0U291dGhXZXN0Iiwic2V0TG9hZFBvc3RNYXJrZXJzIiwiaW5pdE1hcCIsIk1hcCIsIm1hcE9wdGlvbnMiLCJ1cmwiLCJzaXplIiwib3JpZ2luIiwiUG9pbnQiLCJhbmNob3IiLCJzY2FsZWRTaXplIiwiaW5pdGlhbE1hcENlbnRlciIsImlzTmFOIiwiY2VudGVyIiwiem9vbSIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJzY3JvbGx3aGVlbCIsInN0cmVldFZpZXdDb250cm9sIiwibWFwVHlwZUNvbnRyb2wiLCJwYW5Db250cm9sIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsInJlcGxhY2UiLCJkdXJhdGlvbiIsInJlYWR5IiwiJCIsImNzcyIsIiRkb2N1bWVudCIsInJlcXVlc3RGZXRjaCIsIm1vdmVUb0xvYyIsImlkIiwidG9wIiwic2Nyb2xsVG9wIiwidGhlbiIsImFkZFBvc3QiLCJsb2NhdGlvbkpTT04iLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlIiwidW5zaGlmdCIsImZyb250RW5kUG9zdFJlbW92ZSIsImVycm9yIiwiZGF0YSIsImdldCIsInJlbW92ZSIsInB1dCIsInJ1biIsImhvc3RuYW1lIiwiZGV2ZWxvcG1lbnRJUCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJyZWNvbm5lY3QiLCJvbm9wZW4iLCJvbmNsb3NlIiwib25tZXNzYWdlIiwiZSIsInBheWxvYWQiLCJwYXJzZSIsIiRicm9h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TSxHQUNkLE1BQVFGLEdBQUFFLEtBQUEsYUFBWUEsSUFHcEJ1RCxLQUFLNkosT0FBUyxTQUFTcE4sR0FHdEIsTUFGQTBCLFNBQVFhLElBQUksb0JBQ2JiLFFBQUthLElBQUEsWUFBa0J2QyxFQUFLK0csS0FDcEJqSCxFQUFNdU4sSUFBQSxhQUFLck4sT0FHcEJSLFFBQU1DLE9BQVMsT0FDZDZOLEtBQUMsYUFBWSxXQUFBLFNBQUEzTixFQUFBb0YsR0FDYixHQUFDNkYsR0FFRzJDLEVBQVd4RSxTQUFTekcsU0FBU2lMLFNBRWxDQyxFQUFlLGFBR2I1QyxHQURHLGFBQUEyQyxHQUFBQSxHQUFBQyxFQUNHLHdCQUdILDBDQUVKLElBQUlDLEdBQVksR0FBQUMsV0FBZTlDLEdBRTNCK0MsRUFBVyxXQUNkRixFQUFJLEdBQUFDLFdBQUE5QyxHQUdMNkMsR0FBSUcsT0FBYSxXQUNoQmxNLFFBQVFhLElBQUksd0JBR2JrTCxFQUFXSSxRQUFVLFdBQ3BCbk0sUUFBUWEsSUFBSSxvQ0FDYndDLEVBQUE0SSxFQUFvQixNQUdwQkYsRUFBV0ssVUFBWSxTQUFTQyxHQUNoQ3JNLFFBQUFhLElBQVd3TCxFQUNWLElBQUFDLEdBQVlwQixLQUFBcUIsTUFBQUYsRUFBQWIsS0FDWnZOLEdBQVN1TyxXQUFXLE1BQUdGLEVBQUFHLEtBQUFILEVBQUFkIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcblx0J25nUm91dGUnLFxuXHQnZHVTY3JvbGwnXG5dKTtcbiIsIlxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkd2luZG93LCAkaHR0cCl7XG5cdCRzY29wZS5wYWdlSWQgPSB7IFxuXHRcdHBvc3QgOiAwLFxuXHR9O1xuXG5cdCRzY29wZS5uYXZDb2xsYXBzZWQgPSB0cnVlO1xuXHQkc2NvcGUuY29sbGFwc2UgPSBmdW5jdGlvbigpe1xuXHRcdCRzY29wZS5uYXZDb2xsYXBzZWQgPSB0cnVlO1xuXHR9O1xuXG5cdC8qXG5cdC8vIOqwleyVhOyngCDqsp/snLzroZwg66e1IOyXheuNsOydtO2KuOulvCDtlZjripQg67Cp7IudLlxuXHQkc2NvcGUucmVxdWVzdFJlZnJlc2ggPSBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcmVmcmVzaCcpXG5cdFx0LnRoZW4oXG5cdFx0ZnVuY3Rpb24ocmVzKXtcblx0XHRcdGNvbnNvbGUubG9nKFwiT0tBWSwgc2VydmVyIHNheXMgd2UgdXBkYXRlIHRoZSBtYXAhXCIpO1xuXG5cdFx0XHQkc2NvcGUuJGVtaXQoJ3JlZmV0Y2gnLCB7fSk7IC8vIHRvIHVwZGF0ZSBsaXN0XG5cdFx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdtYXB0eXBlaWRfY2hhbmdlZCcpOyAvLyB0byB1cGRhdGUgbWFwXG5cblx0XHRcdCRzY29wZS5yZXF1ZXN0UmVmcmVzaCgpO1xuXHRcdH0sXG5cdFx0ZnVuY3Rpb24oZXJyKXtcblx0XHRcdGNvbnNvbGUubG9nKFwiRXJyb3Igc2hvdWxkIG5vdCBoYXBwZW4gZm9yIHRoaXMuLjpcIiwgZXJyKTtcblx0XHR9KTtcblx0fVxuXHQkc2NvcGUucmVxdWVzdFJlZnJlc2goKTtcblx0Ki9cblxuXHQvLyBhcyBzZXJ2ZXIgc29ja2V0IHNlbmQgJ3dzOm5ld19wb3N0JyAsIHdlIGNhbiB1cGRhdGUgdGhlIG1hcCFcblx0JHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KXtcblx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdtYXB0eXBlaWRfY2hhbmdlZCcpO1xuXHR9KTtcblxuXHQvKiBtb3ZlIHRvIGN1cnJlbnQgbG9jYXRpb24gKi9cblx0JHNjb3BlLm1vdmVUb0N1cnJlbnRMb2NhdGlvbiA9IGZ1bmN0aW9uKCl7XG5cdFx0ZnVuY3Rpb24gZ2V0Q3VyckxvY1N1Y2Nlc3MocG9zKSB7XG4gICAgICAgICAgICAvKiBtYWtlIHN1cmUgdG8gY2hlY2sgd2UgYXJlIG9uIHBvc3QgcGFnZSB3aXRoIG1hcCBmaXJzdCAqL1xuICAgICAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZUlkICE9ICRzY29wZS5wYWdlSWQucG9zdClcbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBjcmQgPSBwb3MuY29vcmRzO1xuXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gY3JkLmxhdGl0dWRlO1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUgPSBjcmQubG9uZ2l0dWRlO1xuXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdMYXRpdHVkZSA6ICcgKyBjcmQubGF0aXR1ZGUpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTG9uZ2l0dWRlOiAnICsgY3JkLmxvbmdpdHVkZSk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdNb3JlIG9yIGxlc3MgJyArIGNyZC5hY2N1cmFjeSArICcgbWV0ZXJzLicpO1xuICAgICAgICAgICAgdmFyIGdvb2dsZUxvYyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoY3JkLmxhdGl0dWRlLCBjcmQubG9uZ2l0dWRlKTtcblxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnaGVhZGluZ19jaGFuZ2VkJywgZ29vZ2xlTG9jKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLm1hcC5wYW5Ubyhnb29nbGVMb2MpXG4gICAgICAgICAgICAkc2NvcGUubWFwLnNldFpvb20oMTUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q3VyckxvY0Vycm9yKGVycikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdFUlJPUignICsgZXJyLmNvZGUgKyAnKTogJyArIGVyci5tZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIGluaXQgbWFwIGFuZCBwbGFjZSBzb21lIG1hcmtlcnMsIHNvIGV2ZXJ5dGhpbmcgc3RhcnQgd2l0aCB0aGlzIGZ1bmN0aW9uLiAqL1xuICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGdldEN1cnJMb2NTdWNjZXNzLCBnZXRDdXJyTG9jRXJyb3IpO1xuXG4gICAgICAgIHN3YWwoeyAgIHRpdGxlOiBcIlwiLCAgIHRleHQ6IFwiTW92aW5nIHRvIGN1cnJlbnQgbG9jYXRpb24uLlwiLCAgIHRpbWVyOiAxNTAwLCAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSB9KTtcblx0fTtcblxuXHQkc2NvcGUuJG9uKCdwYWdlY2hhbmdlJywgZnVuY3Rpb24oXywgcGFnZUlkKXtcblx0XHQkc2NvcGUuY3VycmVudFBhZ2VJZCA9IHBhZ2VJZDtcblx0fSk7XG5cblx0JHNjb3BlLiRvbignbG9jJywgZnVuY3Rpb24oXywgbG9jYXRpb24pe1xuXHRcdGNvbnNvbGUubG9nKCdJTjonLGxvY2F0aW9uKTtcblx0XHR2YXIgbGF0ID0gbG9jYXRpb24ubGF0KCk7XG5cdFx0dmFyIGxvbiA9IGxvY2F0aW9uLmxuZygpO1xuXHRcdCRzY29wZS5wb3N0TG9jYXRpb24gPSB7XG5cdFx0XHRsYXQ6IGxhdCxcblx0XHRcdGxvbjogbG9uXG5cdFx0fTtcblx0XHRjb25zb2xlLmxvZygnU0FWRUQ6JywgJHNjb3BlLnBvc3RMb2NhdGlvbik7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ3BsYWNlJywgZnVuY3Rpb24oXywgcGxhY2Upe1xuXHRcdC8vIEZvcmNpbmcgdGhlIHVwZGF0ZSB3aXRoICRhcHBseSgpIG1ldGhvZCBvbiAkc2NvcGVcblx0XHQvLyBwcm9ibGVtIHJlbGF0ZWQgbm90ZTogaHR0cDovL3d3dy5qZWZmcnlob3VzZXIuY29tL2luZGV4LmNmbS8yMDE0LzYvMi9Ib3ctZG8tSS1ydW4tY29kZS13aGVuLWEtdmFyaWFibGUtY2hhbmdlcy13aXRoLUFuZ3VsYXJKU1xuXHRcdCRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKXtcblx0XHRcdFx0JHNjb3BlLnBvc3RwbGFjZSA9IHBsYWNlO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnU0FWRUQ6JywgJHNjb3BlLnBvc3RwbGFjZSk7XG5cdFx0XHR9XG5cdFx0KTtcblx0fSk7XG5cblx0JHNjb3BlLiRvbignbWFwSW5pdCcsIGZ1bmN0aW9uKF8sIG1hcCl7XG5cdFx0JHNjb3BlLm1hcCA9IG1hcDtcblx0XHRcblx0XHQvLyB1cGRhdGUgbWFwIGJvdW5kcyBhcyBhcHAgbGF1bmNoZXNcblx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdjZW50ZXJfY2hhbmdlZCcpO1xuXHR9KTtcblxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcil7XG5cdCRyb3V0ZVByb3ZpZGVyXG5cdC53aGVuKCcvJywgXG5cdFx0e1xuXHRcdFx0Y29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIFxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvdGVtcGxhdGVzL3Bvc3RzLmh0bWwnXG5cdFx0fSlcblx0Ly8gUmVkaXJlY3QgdG8gdGhlIHJvb3QgcGFnZS5cblx0Lm90aGVyd2lzZShcblx0XHR7XG4gICBcdFx0XHRyZWRpcmVjdFRvOiAnLydcblx0XHR9KTtcbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnVXRpbFN2YycsIGZ1bmN0aW9uKCl7XG5cdHZhciBzdmMgPSB0aGlzO1xuXG5cdHN2Yy5kZWcycmFkID0gZnVuY3Rpb24oZGVnKSB7XG5cdCAgcmV0dXJuIGRlZyAqIChNYXRoLlBJLzE4MCk7XG5cdH07XG5cblx0c3ZjLmdldERpc3RhbmNlRnJvbUxhdExvbkluS20gPSBmdW5jdGlvbiAobGF0MSxsb24xLGxhdDIsbG9uMikge1xuXHQgIHZhciBSID0gNjM3MTtcblx0ICB2YXIgZExhdCA9IHN2Yy5kZWcycmFkKGxhdDItbGF0MSk7XG5cdCAgdmFyIGRMb24gPSBzdmMuZGVnMnJhZChsb24yLWxvbjEpOyBcblx0ICB2YXIgYSA9IFxuXHQgICAgTWF0aC5zaW4oZExhdC8yKSAqIE1hdGguc2luKGRMYXQvMikgK1xuXHQgICAgTWF0aC5jb3Moc3ZjLmRlZzJyYWQobGF0MSkpICogTWF0aC5jb3Moc3ZjLmRlZzJyYWQobGF0MikpICogXG5cdCAgICBNYXRoLnNpbihkTG9uLzIpICogTWF0aC5zaW4oZExvbi8yKVxuXHQgICAgOyBcblx0ICB2YXIgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEtYSkpOyBcblx0ICB2YXIgZCA9IFIgKiBjO1xuXHQgIHJldHVybiBkO1xuXHR9O1xufSk7IiwiXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5kaXJlY3RpdmUoJ2FwcE1hcCcsIGZ1bmN0aW9uKFBvc3RzU3ZjLCBVdGlsU3ZjLCAkY29tcGlsZSwgJHRpbWVvdXQpIHtcbiAgICAvLyBkaXJlY3RpdmUgbGluayBmdW5jdGlvblxuICAgIHZhciBsaW5rID0gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIHZhciBtYXA7XG4gICAgICAgIHZhciBjdXJyZW50X21hcF9udztcbiAgICAgICAgdmFyIGN1cnJlbnRfbWFwX3NlO1xuICAgICAgICBcbiAgICAgICAgdmFyIGltYWdlUG9zdCA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vY2F0Y2htZS5pZnlvdWNhbi5jb20vaW1hZ2VzL3BpY3R1cmVzL0lZQ19JY29ucy9JWUNfTG9jYXRpb25fSWNvbl9TbWFsbC5wbmcnLFxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTAwLCAxMDApLFxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgxNywgMzQpLFxuICAgICAgICAgICAgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTcsIDI1KVxuICAgICAgICB9O1xuXG4gICAgICAgICB2YXIgaW1hZ2VUYXJnZXQgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vd3d3LmNsa2VyLmNvbS9jbGlwYXJ0cy9VL1Avai9NL0kvaS94LW1hcmsteWVsbG93LW1kLnBuZycsXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgxMDAsIDEwMCksXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDE3LCAzNCksXG4gICAgICAgICAgICBzY2FsZWRTaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyNSwgMjUpXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gbWFwIGNvbmZpZ1xuICAgICAgICBjb25zb2xlLmxvZygnd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSAnLCB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlICk7XG5cbiAgICAgICAgdmFyIGluaXRpYWxNYXBDZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDM0LjA1LCAtMTE4LjI0KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghaXNOYU4od2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSkgJiYgIWlzTmFOKHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlKSlcbiAgICAgICAge1xuICAgICAgICAgICAgaW5pdGlhbE1hcENlbnRlciA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcod2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSwgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJ3dpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgJywgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSApO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coaW5pdGlhbE1hcENlbnRlcik7XG5cbiAgICAgICAgdmFyIG1hcE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgY2VudGVyICAgICAgOiBpbml0aWFsTWFwQ2VudGVyLFxuICAgICAgICAgICAgICAgIHpvb20gICAgICAgIDogMTUsXG4gICAgICAgICAgICAgICAgTWFwVHlwZUlkICAgOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcbiAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbCA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGFuQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgLy96b29tQ29udHJvbDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gZHJhdyBtYXAgd2l0aCBoZWxwZXIgbWFya2Vyc1xuICAgICAgICB2YXIgaGVscGVyTWFya2VycyA9IFtdO1xuICAgICAgICBmdW5jdGlvbiBkcmF3SGVscGVyTWFya2VyKGxvY2F0aW9uKXtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXJrZXI7IG1hcmtlciA9IGhlbHBlck1hcmtlcnNbaV07IGkrKykge1xuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzID0gW107XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGxvY2F0aW9uLCBcbiAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVRhcmdldFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUhlbHBlck1hcmtlcigpe1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1hcmtlcjsgbWFya2VyID0gaGVscGVyTWFya2Vyc1tpXTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhlbHBlck1hcmtlcnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBsb2NhdGlvbiBpbmZvcihsb24sbGF0KVxuICAgICAgICAgICAgc2NvcGUuJGVtaXQoJ2xvYycsIGxvY2F0aW9uKTtcblxuICAgICAgICAgICAgZHJhd0hlbHBlck1hcmtlcihsb2NhdGlvbik7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBwbGFjZSBmb3JtYXR0ZWRfYWRkcmVzcyBhbmQgZHJhdyBpY29uXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKCB7ICdsYXRMbmcnOiBsb2NhdGlvbiB9LCBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAvLyBhcyB1c2VyIGNsaWNrcyBvbiB0aGUgbWFwLFxuICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gc2F2ZSB0aGUgZm9ybWF0dGVkIGFkZHJlc3MgaW4gJHNjb3BlIGFuZFxuICAgICAgICAgICAgICAgIC8vIGl0IHdpbGwgYmUgdXNlZCB0aHJvdWdoIHBvc3RzLmN0cmxcbiAgICAgICAgICAgICAgICAvLyBlbWl0IGJyb2FkY2FzZSAncGxhY2UnIGFuZCBzZW5kIHRoaXMgdG8gYXBwbGljYXRpb24uY3RybFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBmb3JtYXR0ZWRfYWRkcmVzc1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZW1pdCgncGxhY2UnLCByZXN1bHRzWzFdLmZvcm1hdHRlZF9hZGRyZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKFwiXCIsXCJMb2NhdGlvbiBkb2VzIG5vdCBleGlzdHNcIik7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdwbGFjZScsIFwiTG9jYXRpb24gZG9lcyBub3QgZXhpc3RzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGxhY2UgYSBtYXJrZXIgYW5kIGluZm9XaW5kb3dcbiAgICAgICAgdmFyIG1hcmtlcnMgPSBbXTtcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTWFwKCkgeyAgIFxuICAgICAgICAgICAgUG9zdHNTdmMuZmV0Y2goKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xuXG4gICAgICAgICAgICAgICAgLy8gZHJhdyBsYXRlc3QgdXBkYXRlXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gcG9zdHNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIG1hcmtlcnMgcG9zdCBpcyBleGlzaXRpbmcgb25lLCB3ZSBkb24ndCB3YW50IHRvIGRyYXcgaXQgYWdhaW4uXG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgZHJhdyBuZXcgb25lcyFcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1tqXTsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3N0Ll9pZCA9PSBtYXJrZXIucG9zdC5faWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IG51bGw7IC8vIOydtOuvuCDqt7jroKTsp4Qg7Y+s7Iqk7Yq4652866m0LCBudWxs66GcLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyDsnbQgbG9vcOydgCBwb3N0Ll9pZOunjCDqsoDsgqzsmqnsnoTsnLzroZwsIOunjOyVvSDqsrnsuZjrqbQg67CU66GcIGxvb3DsnYQg66mI7Law64+EIOq0nOywruuLpC5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHBvc3TqsIAg7JuQ656YIOyeiOyXh+uNmOqyg+ydtOuptCBwb3N06rCAIG51bGzroZwg7IWLIOuQmOyXiOydhOqyg+ydtOqzoCwgbG9jYXRpb27tlITroZztjbzti7Drj4Qg7J6I64qU7KeAIO2ZleyduO2VmOyekFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc3QgfHwgIXBvc3QuaGFzT3duUHJvcGVydHkoJ2xvY2F0aW9uJykpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ29vZ2xlTG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbi5sYXQsIGxvY2F0aW9uLmxvbik7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyDrsJTsmrTrjZTrpqwg7JWI7JeQIOyeiOuKlOyngOu2gO2EsCDssrTtgazrpbwg7ZWY7J6lIFxuICAgICAgICAgICAgICAgICAgICBpZiAoIShnb29nbGVMb2MubGF0KCkgPCBjdXJyZW50X21hcF9udy5sYXQoKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEoZ29vZ2xlTG9jLmxhdCgpID4gY3VycmVudF9tYXBfc2UubGF0KCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAhKGdvb2dsZUxvYy5sbmcoKSA8IGN1cnJlbnRfbWFwX3NlLmxuZygpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIShnb29nbGVMb2MubG5nKCkgPiBjdXJyZW50X21hcF9udy5sbmcoKSkgKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFya2VyIG9wdGlvbiBzZXR0aW5nXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJrZXJPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGdvb2dsZUxvYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiQnViYmxlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVBvc3RcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIobWFya2VyT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdXAgc2VsZiByZW1vdmUgZm9yIG1hcmtlciBpdHNlbGYgYW5kIGZyb20gbWFya2VycyBjb2xsZWN0aW9uIGF0IGZyb250LWVuZFxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKG9sZF9tYXJrZXIsIG9sZF9wb3N0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkX21hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBtYXJrZXI7IG1hcmtlciA9IG1hcmtlcnNba107IGsrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkX3Bvc3QuX2lkID09IG1hcmtlci5wb3N0Ll9pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnNwbGljZShrLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfShtYXJrZXIsIHBvc3QpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0LmxpZmVzcGFuKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBtYXJrZXIgdG8gYXJyYXksIHRoaXMgbWVhbnMgdGhhdCBpdCBoYXMgYmVlbiBkcmF3biB0byBtYXBcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vycy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcjogbWFya2VyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgIDogcG9zdFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBEUkFXSU5HIE1FU1NBR0UgV0lORE9XIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBpZD1cImJ1YmJsZVBvc3RcIj4nICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QuYm9keSArIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+PGRpdiBpZD1cImJ1YmJsZUxpZmVCYXJcIj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIOyKpOy9lO2UhOyXkOyEnOu2gO2EsCDsg4jroZzsmrQg7LCo7J2865OcIOyKpOy9lO2UhOulvCDrp4zrk6TslrQgZWFjaCBmb3IgbG9vcOyXkOyEnCDsgqzsmqntlZzri6QuXG4gICAgICAgICAgICAgICAgICAgIC8vIC0tPiDtlbTslbwsIOqwgSBET03snbQg6rCB6rCB7J2YIHNjb3Bl66W8IOqwgOyguOyEnCBwb3N0IG1zZ+qwgCDslYgg6rK57Lmc64ukLlxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHBhcmVudC4kbmV3KHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcGVuSW5mb1dpbmRvdyA9IChmdW5jdGlvbihtYXJrZXIsIHNjb3BlLCBwb3N0bXNnLCBwb3N0bGlmZSl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgd2luZG93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9XaW5kb3dPcHRpb25zID0geyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl4ZWxPZmZzZXQ6IG5ldyBnb29nbGUubWFwcy5TaXplKC00MS41LCAxMC4wKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KGluZm9XaW5kb3dPcHRpb25zKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbXBpbGUgaXQgYmVmb3JlIGxvYWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gJzxkaXYgbWFwLW1zZz48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21waWxlZCA9ICRjb21waWxlKGNvbnRlbnQpKHNjb3BlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdG8gbWFrZSBkYXRhIGF2YWlsYWJsZSB0byB0ZW1wbGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1zZyA9IHBvc3Rtc2c7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucG9zdGxpZmUgPSBwb3N0bGlmZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudCggY29tcGlsZWRbMF0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4obWFwICwgbWFya2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pKG1hcmtlciwgY2hpbGQsIHBvc3QuYm9keSwgcG9zdC5saWZlc3Bhbik7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBvcGVuSW5mb1dpbmRvdygpO1xuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEVORCBvZiBEUkFXSU5HIE1FU1NBR0UgV0lORE9XIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICAgICAgICAgIH0gLy8gZW5kIG9mIGZvci1sb29wXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldFNlYXJjaEJveCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgc2VhcmNoIGJveCBhbmQgbGluayBpdCB0byB0aGUgVUkgZWxlbWVudC5cbiAgICAgICAgICAgIHZhciBpbnB1dCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFjLWlucHV0JykpOyAvLyBAdHlwZSB7SFRNTElucHV0RWxlbWVudH0gIFxuICAgICAgICAgICAgdmFyIGN1cnJMb2NCdG4gPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1jdXJyJykpOyAgICAgIFxuICAgICAgICAgICAgbWFwLmNvbnRyb2xzW2dvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfTEVGVF0ucHVzaChpbnB1dCk7XG4gICAgICAgICAgICBtYXAuY29udHJvbHNbZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLlRPUF9SSUdIVF0ucHVzaChjdXJyTG9jQnRuKTtcblxuICAgICAgICAgICAgdmFyIHNlYXJjaEJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KChpbnB1dCkpOyAvLyBAdHlwZSB7SFRNTElucHV0RWxlbWVudH0gXG5cbiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgdGhlIGV2ZW50IGZpcmVkIHdoZW4gdGhlIHVzZXIgc2VsZWN0cyBhbiBpdGVtIGZyb20gdGhlXG4gICAgICAgICAgICAvLyBwaWNrIGxpc3QuIFJldHJpZXZlIHRoZSBtYXRjaGluZyBwbGFjZXMgZm9yIHRoYXQgaXRlbS5cbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHNlYXJjaEJveCwgJ3BsYWNlc19jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlcyA9IHNlYXJjaEJveC5nZXRQbGFjZXMoKTtcblxuICAgICAgICAgICAgICAgIGlmIChwbGFjZXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyB0YWtlIG9ubHkgMSBzcG90XG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlID0gcGxhY2VzWzBdO1xuXG4gICAgICAgICAgICAgICAgLy8gd2hlbiBzZWFyY2ggaGFwcGVucywgbG9jYXRpb24gd2lsbCBiZSB1cGRhdGVkIGFzIHdlbGwgZm9yIHBvc3RcbiAgICAgICAgICAgICAgICAvLyBzY29wZS4kZW1pdCgncGxhY2UnLCBwbGFjZS5mb3JtYXR0ZWRfYWRkcmVzcyk7XG4gICAgICAgICAgICAgICAgZHJhd0FuZFNldFBsYWNlKHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXRpdHVkZTtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSA9IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxvbmdpdHVkZTtcblxuICAgICAgICAgICAgICAgIG1hcC5wYW5UbyhwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgbWFwLnNldFpvb20oMTYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRDbGlja01hcCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIGNsaWNrIGV2ZW50IG9uIG1hcCB0byBkcmF3IG1hcmtlclxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShldmVudC5sYXRMbmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRNb3ZlVG9DdXJyZW50TG9jYXRpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBtb3ZpbmcgdG8gYSBwb3N0J3MgbG9jYXRpb24gYW5kIGRyYXcgYSBtYXJrZXIgdGhlcmVcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2hlYWRpbmdfY2hhbmdlZCcsIGZ1bmN0aW9uKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgZHJhd0FuZFNldFBsYWNlKGxvY2F0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0Q2VudGVyQ2hhbmdlZCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2NlbnRlcl9jaGFuZ2VkJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gbWFwLmdldENlbnRlcigpLmxhdCgpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlID0gbWFwLmdldENlbnRlcigpLmxuZygpO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlQm91bmRzKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0TWFwRHJhZ0VuZCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2RyYWdlbmQnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHVwZGF0ZU1hcCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJvdW5kcygpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBtYXAuZ2V0Qm91bmRzKCk7XG4gICAgICAgICAgICB2YXIgbmUgPSBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7IC8vIExhdExuZyBvZiB0aGUgbm9ydGgtZWFzdCBjb3JuZXJcbiAgICAgICAgICAgIHZhciBzdyA9IGJvdW5kcy5nZXRTb3V0aFdlc3QoKTsgLy8gTGF0TG5nIG9mIHRoZSBzb3V0aC13ZXN0IGNvcmRlclxuICAgICAgICAgICAgLy9Zb3UgZ2V0IG5vcnRoLXdlc3QgYW5kIHNvdXRoLWVhc3QgY29ybmVycyBmcm9tIHRoZSB0d28gYWJvdmU6XG5cbiAgICAgICAgICAgIGN1cnJlbnRfbWFwX253ID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhuZS5sYXQoKSwgc3cubG5nKCkpO1xuICAgICAgICAgICAgY3VycmVudF9tYXBfc2UgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN3LmxhdCgpLCBuZS5sbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIHNldExvYWRQb3N0TWFya2VycygpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIG1hbnVhbGx5IHJlbG9hZCBtYXJrZXJzIC8gUkVGUkVTSFxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZW1vdmVIZWxwZXJNYXJrZXIoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVNYXAoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5pdCB0aGUgbWFwXG4gICAgICAgIGZ1bmN0aW9uIGluaXRNYXAoKSB7XG4gICAgICAgICAgICBpZiAobWFwID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGVsZW1lbnRbMF0sIG1hcE9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZXRMb2FkUG9zdE1hcmtlcnMoKTtcblxuICAgICAgICAgICAgLy8gYnJvYWRjYXN0IHRvIHNlbmQgbWFwIHRvIGFwcGxpY2F0aW9uIGN0cmxcbiAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdtYXBJbml0JywgbWFwKTtcblxuICAgICAgICAgICAgc2V0Q2xpY2tNYXAoKTtcblxuICAgICAgICAgICAgc2V0U2VhcmNoQm94KCk7XG5cbiAgICAgICAgICAgIHNldENlbnRlckNoYW5nZWQoKTtcblxuICAgICAgICAgICAgc2V0TW92ZVRvQ3VycmVudExvY2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHNldE1hcERyYWdFbmQoKTtcblxuICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG5cbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdXBkYXRlQm91bmRzKCk7XG4gICAgICAgICAgICB9LCA4MDApO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gXG4gICAgICAgIGluaXRNYXAoKTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiBpZD1cIm1hcC1jYW52YXNcIj48L2Rpdj4nLFxuICAgICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgICBsaW5rOiBsaW5rXG4gICAgfTtcbn0pO1xuXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5kaXJlY3RpdmUoJ21hcE1zZycsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi90ZW1wbGF0ZXMvd2luZG93Lmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBhdHRycykgeyAgICAgICAgXG4gICAgICAgIHZhciBkdXJhdGlvbiA9IHNjb3BlLnBvc3RsaWZlICsgXCJtc1wiO1xuXG4gICAgICAgIC8vIGFzIHRlbXBsYXRlVXJsIERPTSBpcyBsb2FkZWQsIHRoaXMgZnVuY3Rpb24gd2lsbCBnZXQgY2FsbGVkLlxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQoJ2RpdiBkaXYgLnBvc3RsaWZlYmFyJykuY3NzKFwiYW5pbWF0aW9uLWR1cmF0aW9uXCIsIGR1cmF0aW9uKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkpxdWVyeSBjYWxsZWQgOlwiICsgIGR1cmF0aW9uICsgXCIgYW5kIG1zZzpcIiArIHNjb3BlLm1zZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICB9XG4gICB9XG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcci5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCBQb3N0c1N2YywgJHdpbmRvdywgJGRvY3VtZW50KXtcclxyXHQvKiBlbWl0IGJyb2FkY2FzdCBmb3IgY3VycmVudCBwYWdlSWQgKi9cclx0JHNjb3BlLiRlbWl0KCdwYWdlY2hhbmdlJywgJHNjb3BlLnBhZ2VJZC5wb3N0KTtcclxyXHQkc2NvcGUucG9zdHMgPSBbXTtcclxyLyog6rCV7JWE7KeAIEdFVOuVjCDtlYTsmpTtlojsl4fsnYwuXHJcdCRzY29wZS4kb24oJ3JlZmV0Y2gnLCBmdW5jdGlvbihfLCBvYmope1xyXHRcdCRzY29wZS5yZXF1ZXN0RmV0Y2goKTtcclx0fSk7XHIqL1xyXHRcclx0LyogYXMgc2VydmVyIHRlbGxzIHRoZXJlIHdhcyBuZXcgcG9zdCwgbGV0cyByZS1sb2FkIGxpc3QgZGF0YSAqL1xyXHQkc2NvcGUuJG9uKCd3czpuZXdfcG9zdCcsIGZ1bmN0aW9uKF8sIHBvc3Qpe1xyXHRcdCRzY29wZS5yZXF1ZXN0RmV0Y2goKTtcclx0fSk7XHJcclx0LyogbW92ZSB0byBwb3N0J3MgbG9jYXRpb24gKi9cclx0JHNjb3BlLm1vdmVUb0xvYyA9IGZ1bmN0aW9uKGlkKXtcclx0XHR2YXIgcG9zdCA9ICgkc2NvcGUucG9zdHNbaWRdKTtcclxyXHRcdHZhciBsb2NhdGlvbiA9IGFuZ3VsYXIuZnJvbUpzb24ocG9zdC5sb2NhdGlvbik7XHJcdFx0dmFyIGdvb2dsZUxvYyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobG9jYXRpb24ubGF0LCBsb2NhdGlvbi5sb24pO1xyXHJcdFx0JHNjb3BlLm1hcC5wYW5Ubyhnb29nbGVMb2MpO1xyXHRcdCRzY29wZS5tYXAuc2V0Wm9vbSgxNik7XHJcclx0XHQvKiB1c2luZyBhbmd1bGFyLXNjcm9sbCB0byBtb3ZlIHRvIHRoZSB0b3Agc21vb3RobHkgKi9cclx0XHR2YXIgdG9wID0gMDtcciAgICBcdHZhciBkdXJhdGlvbiA9IDQ4MDtcciAgICBcdCRkb2N1bWVudC5zY3JvbGxUb3AodG9wLCBkdXJhdGlvbikudGhlbihmdW5jdGlvbigpIHtcciAgICAgXHRcdCBjb25zb2xlICYmIGNvbnNvbGUubG9nKCdZb3UganVzdCBzY3JvbGxlZCB0byB0aGUgdG9wIScpO1xyICAgIFx0fSk7XHJcclx0fTtcclxyXHQkc2NvcGUuYWRkUG9zdCA9IGZ1bmN0aW9uKCkge1xyXHRcdC8qIGdldCBhdXRvY29tcGxldGVkIHBsYWNlIGFuZCByZXNldChzZXQgdG8gdW5kZWZpbmVkKSAqL1xyXHRcdHZhciBwbGFjZSA9ICRzY29wZS5wb3N0cGxhY2U7XHJcdFx0dmFyIGxvY2F0aW9uID0gJHNjb3BlLnBvc3RMb2NhdGlvbjtcclxyXHRcdHZhciBsb2NhdGlvbkpTT04gPSBKU09OLnN0cmluZ2lmeShsb2NhdGlvbik7XHJcclx0XHRjb25zb2xlLmxvZyhcIlBPU1QgbG9jYXRpb246XCIsIGxvY2F0aW9uSlNPTik7XHJcdFx0Y29uc29sZS5sb2coXCJQT1NUIHBsYWNlOlwiLCBwbGFjZSk7XHJcclx0XHRQb3N0c1N2Yy5jcmVhdGUoXHJcdFx0e1xyXHRcdFx0Ym9keSAgICA6ICRzY29wZS5jb250ZW50LFxyXHRcdFx0bG9jYXRpb246IGxvY2F0aW9uSlNPTixcclx0XHRcdHBsYWNlICAgOiBwbGFjZVxyXHRcdH0pXHJcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdCl7XHJcdFx0XHQvKiBtYW51YWxseSByZWxvYWQgbWFya2VycyBcclx0XHRcdHVzaW5nIG1hcHR5cGVpZCBzaW5jZSBpdHMgbW9zdCBsZWFzdCB1c2VkIGV2ZW50LCAtIGtpbmQgb2YgaGFja3kgd2F5IHRvIGRvIGl0XHJcdFx0XHQqL1xyXHRcdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnKTtcclxyXHRcdFx0JHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XHJcclx0XHRcdGNvbnNvbGUubG9nKFwicG9zdCBoYXMgYmVlbiBwb3N0c2VkLiByZWFkeSBmb3IgZGVsZXRlXCIpO1xyXHJcdFx0XHQvKiBmcm9udCBlbmQgc2lkZSBsaXN0IHBvc3QgcmVtb3ZlICovXHJcdFx0XHR2YXIgZnJvbnRFbmRQb3N0UmVtb3ZlID0gZnVuY3Rpb24oKXsgXHJcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnBvc3RzLmxlbmd0aDsgKytpKXtcclx0XHRcdFx0aWYgKHBvc3QuX2lkID09ICRzY29wZS5wb3N0c1tpXS5faWQpXHJcdFx0XHRcdFx0JHNjb3BlLnBvc3RzLnNwbGljZShpLCAxKTtcclx0XHRcdFx0fVxyXHRcdFx0fTtcclx0XHRcdHNldFRpbWVvdXQoZnJvbnRFbmRQb3N0UmVtb3ZlLCBwb3N0LmxpZmVzcGFuKTtcclxyXHRcdFx0LyogcmVzZXQgaW5wdXQgZm9ybXMgKi9cclx0XHRcdCRzY29wZS5jb250ZW50ICA9IG51bGw7XHJcdFx0fSlcclx0XHQuZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKXtcclx0XHRcdHN3YWwoXCJQb3N0IGZhaWxlZFwiLCBcIlBsZWFzZSBjb21wbGV0ZSB0aGUgZnJvbSBjb3JyZWN0bHlcIiwgXCJlcnJvclwiKTtcclx0XHR9KTtcclxyXHR9O1xyXHJcdC8qIGFzIHNlcnZlciB0ZWxscyB0aGVyZSB3YXMgbmV3IHBvc3QsIGxldHMgcmUtbG9hZCBsaXN0IGRhdGEgKi9cclx0JHNjb3BlLnJlcXVlc3RGZXRjaCA9IGZ1bmN0aW9uKCkge1xyXHRcdFBvc3RzU3ZjLmZldGNoKClcclx0XHQuc3VjY2VzcyhmdW5jdGlvbihwb3N0cyl7XHJcdFx0XHRjb25zb2xlLmxvZygnUG9zdHMgaGF2ZSBiZWVuIGxvYWRlZCBzdWNjZXNzZnVsbHkgZm9yIGZyb250IHBhZ2UnKTtcclx0XHRcdCRzY29wZS5wb3N0cyA9IHBvc3RzO1xyXHRcdH0pO1xyXHR9O1xyXHJcdCRzY29wZS5yZXF1ZXN0RmV0Y2goKTtccn0pO1xyIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnUG9zdHNTdmMnLCBmdW5jdGlvbigkaHR0cCl7XG5cdHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcblx0fTtcblxuXHR0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHBvc3Qpe1xuXHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdH07XG5cblx0dGhpcy5yZW1vdmUgPSBmdW5jdGlvbihwb3N0KXtcblx0XHRjb25zb2xlLmxvZyhcImRlbGV0aW5nIHBvc3RpbmdcIik7XG5cdFx0Y29uc29sZS5sb2coJ3Bvc3QuX2lkOicsIHBvc3QuX2lkKTtcblx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdH07XG59KTsiLCJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG5cdCduZ1JvdXRlJyxcblx0J2R1U2Nyb2xsJ1xuXSk7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignQXBwbGljYXRpb25DdHJsJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkd2luZG93LCAkaHR0cCl7XG5cdCRzY29wZS5wYWdlSWQgPSB7IFxuXHRcdHBvc3QgOiAwLFxuXHR9O1xuXG5cdCRzY29wZS5uYXZDb2xsYXBzZWQgPSB0cnVlO1xuXHQkc2NvcGUuY29sbGFwc2UgPSBmdW5jdGlvbigpe1xuXHRcdCRzY29wZS5uYXZDb2xsYXBzZWQgPSB0cnVlO1xuXHR9O1xuXG5cdC8qXG5cdC8vIOqwleyVhOyngCDqsp/snLzroZwg66e1IOyXheuNsOydtO2KuOulvCDtlZjripQg67Cp7IudLlxuXHQkc2NvcGUucmVxdWVzdFJlZnJlc2ggPSBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcmVmcmVzaCcpXG5cdFx0LnRoZW4oXG5cdFx0ZnVuY3Rpb24ocmVzKXtcblx0XHRcdGNvbnNvbGUubG9nKFwiT0tBWSwgc2VydmVyIHNheXMgd2UgdXBkYXRlIHRoZSBtYXAhXCIpO1xuXG5cdFx0XHQkc2NvcGUuJGVtaXQoJ3JlZmV0Y2gnLCB7fSk7IC8vIHRvIHVwZGF0ZSBsaXN0XG5cdFx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdtYXB0eXBlaWRfY2hhbmdlZCcpOyAvLyB0byB1cGRhdGUgbWFwXG5cblx0XHRcdCRzY29wZS5yZXF1ZXN0UmVmcmVzaCgpO1xuXHRcdH0sXG5cdFx0ZnVuY3Rpb24oZXJyKXtcblx0XHRcdGNvbnNvbGUubG9nKFwiRXJyb3Igc2hvdWxkIG5vdCBoYXBwZW4gZm9yIHRoaXMuLjpcIiwgZXJyKTtcblx0XHR9KTtcblx0fVxuXHQkc2NvcGUucmVxdWVzdFJlZnJlc2goKTtcblx0Ki9cblxuXHQvLyBhcyBzZXJ2ZXIgc29ja2V0IHNlbmQgJ3dzOm5ld19wb3N0JyAsIHdlIGNhbiB1cGRhdGUgdGhlIG1hcCFcblx0JHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KXtcblx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdtYXB0eXBlaWRfY2hhbmdlZCcpO1xuXHR9KTtcblxuXHQvKiBtb3ZlIHRvIGN1cnJlbnQgbG9jYXRpb24gKi9cblx0JHNjb3BlLm1vdmVUb0N1cnJlbnRMb2NhdGlvbiA9IGZ1bmN0aW9uKCl7XG5cdFx0ZnVuY3Rpb24gZ2V0Q3VyckxvY1N1Y2Nlc3MocG9zKSB7XG4gICAgICAgICAgICAvKiBtYWtlIHN1cmUgdG8gY2hlY2sgd2UgYXJlIG9uIHBvc3QgcGFnZSB3aXRoIG1hcCBmaXJzdCAqL1xuICAgICAgICAgICAgaWYgKCRzY29wZS5jdXJyZW50UGFnZUlkICE9ICRzY29wZS5wYWdlSWQucG9zdClcbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBjcmQgPSBwb3MuY29vcmRzO1xuXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gY3JkLmxhdGl0dWRlO1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUgPSBjcmQubG9uZ2l0dWRlO1xuXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdMYXRpdHVkZSA6ICcgKyBjcmQubGF0aXR1ZGUpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTG9uZ2l0dWRlOiAnICsgY3JkLmxvbmdpdHVkZSk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdNb3JlIG9yIGxlc3MgJyArIGNyZC5hY2N1cmFjeSArICcgbWV0ZXJzLicpO1xuICAgICAgICAgICAgdmFyIGdvb2dsZUxvYyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoY3JkLmxhdGl0dWRlLCBjcmQubG9uZ2l0dWRlKTtcblxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnaGVhZGluZ19jaGFuZ2VkJywgZ29vZ2xlTG9jKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLm1hcC5wYW5Ubyhnb29nbGVMb2MpXG4gICAgICAgICAgICAkc2NvcGUubWFwLnNldFpvb20oMTUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q3VyckxvY0Vycm9yKGVycikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdFUlJPUignICsgZXJyLmNvZGUgKyAnKTogJyArIGVyci5tZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIGluaXQgbWFwIGFuZCBwbGFjZSBzb21lIG1hcmtlcnMsIHNvIGV2ZXJ5dGhpbmcgc3RhcnQgd2l0aCB0aGlzIGZ1bmN0aW9uLiAqL1xuICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGdldEN1cnJMb2NTdWNjZXNzLCBnZXRDdXJyTG9jRXJyb3IpO1xuXG4gICAgICAgIHN3YWwoeyAgIHRpdGxlOiBcIlwiLCAgIHRleHQ6IFwiTW92aW5nIHRvIGN1cnJlbnQgbG9jYXRpb24uLlwiLCAgIHRpbWVyOiAxNTAwLCAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSB9KTtcblx0fTtcblxuXHQkc2NvcGUuJG9uKCdwYWdlY2hhbmdlJywgZnVuY3Rpb24oXywgcGFnZUlkKXtcblx0XHQkc2NvcGUuY3VycmVudFBhZ2VJZCA9IHBhZ2VJZDtcblx0fSk7XG5cblx0JHNjb3BlLiRvbignbG9jJywgZnVuY3Rpb24oXywgbG9jYXRpb24pe1xuXHRcdGNvbnNvbGUubG9nKCdJTjonLGxvY2F0aW9uKTtcblx0XHR2YXIgbGF0ID0gbG9jYXRpb24ubGF0KCk7XG5cdFx0dmFyIGxvbiA9IGxvY2F0aW9uLmxuZygpO1xuXHRcdCRzY29wZS5wb3N0TG9jYXRpb24gPSB7XG5cdFx0XHRsYXQ6IGxhdCxcblx0XHRcdGxvbjogbG9uXG5cdFx0fTtcblx0XHRjb25zb2xlLmxvZygnU0FWRUQ6JywgJHNjb3BlLnBvc3RMb2NhdGlvbik7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ3BsYWNlJywgZnVuY3Rpb24oXywgcGxhY2Upe1xuXHRcdC8vIEZvcmNpbmcgdGhlIHVwZGF0ZSB3aXRoICRhcHBseSgpIG1ldGhvZCBvbiAkc2NvcGVcblx0XHQvLyBwcm9ibGVtIHJlbGF0ZWQgbm90ZTogaHR0cDovL3d3dy5qZWZmcnlob3VzZXIuY29tL2luZGV4LmNmbS8yMDE0LzYvMi9Ib3ctZG8tSS1ydW4tY29kZS13aGVuLWEtdmFyaWFibGUtY2hhbmdlcy13aXRoLUFuZ3VsYXJKU1xuXHRcdCRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKXtcblx0XHRcdFx0JHNjb3BlLnBvc3RwbGFjZSA9IHBsYWNlO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnU0FWRUQ6JywgJHNjb3BlLnBvc3RwbGFjZSk7XG5cdFx0XHR9XG5cdFx0KTtcblx0fSk7XG5cblx0JHNjb3BlLiRvbignbWFwSW5pdCcsIGZ1bmN0aW9uKF8sIG1hcCl7XG5cdFx0JHNjb3BlLm1hcCA9IG1hcDtcblx0XHRcblx0XHQvLyB1cGRhdGUgbWFwIGJvdW5kcyBhcyBhcHAgbGF1bmNoZXNcblx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdjZW50ZXJfY2hhbmdlZCcpO1xuXHR9KTtcblxufSk7XG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb25maWcoZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKXtcblx0JHJvdXRlUHJvdmlkZXJcblx0LndoZW4oJy8nLCBcblx0XHR7XG5cdFx0XHRjb250cm9sbGVyOiAnUG9zdHNDdHJsJywgXG5cdFx0XHR0ZW1wbGF0ZVVybDogJy90ZW1wbGF0ZXMvcG9zdHMuaHRtbCdcblx0XHR9KVxuXHQvLyBSZWRpcmVjdCB0byB0aGUgcm9vdCBwYWdlLlxuXHQub3RoZXJ3aXNlKFxuXHRcdHtcbiAgIFx0XHRcdHJlZGlyZWN0VG86ICcvJ1xuXHRcdH0pO1xufSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1V0aWxTdmMnLCBmdW5jdGlvbigpe1xuXHR2YXIgc3ZjID0gdGhpcztcblxuXHRzdmMuZGVnMnJhZCA9IGZ1bmN0aW9uKGRlZykge1xuXHQgIHJldHVybiBkZWcgKiAoTWF0aC5QSS8xODApO1xuXHR9O1xuXG5cdHN2Yy5nZXREaXN0YW5jZUZyb21MYXRMb25JbkttID0gZnVuY3Rpb24gKGxhdDEsbG9uMSxsYXQyLGxvbjIpIHtcblx0ICB2YXIgUiA9IDYzNzE7XG5cdCAgdmFyIGRMYXQgPSBzdmMuZGVnMnJhZChsYXQyLWxhdDEpO1xuXHQgIHZhciBkTG9uID0gc3ZjLmRlZzJyYWQobG9uMi1sb24xKTsgXG5cdCAgdmFyIGEgPSBcblx0ICAgIE1hdGguc2luKGRMYXQvMikgKiBNYXRoLnNpbihkTGF0LzIpICtcblx0ICAgIE1hdGguY29zKHN2Yy5kZWcycmFkKGxhdDEpKSAqIE1hdGguY29zKHN2Yy5kZWcycmFkKGxhdDIpKSAqIFxuXHQgICAgTWF0aC5zaW4oZExvbi8yKSAqIE1hdGguc2luKGRMb24vMilcblx0ICAgIDsgXG5cdCAgdmFyIGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxLWEpKTsgXG5cdCAgdmFyIGQgPSBSICogYztcblx0ICByZXR1cm4gZDtcblx0fTtcbn0pO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5kaXJlY3RpdmUoJ2FwcE1hcCcsIGZ1bmN0aW9uKFBvc3RzU3ZjLCBVdGlsU3ZjLCAkY29tcGlsZSwgJHRpbWVvdXQpIHtcbiAgICAvLyBkaXJlY3RpdmUgbGluayBmdW5jdGlvblxuICAgIHZhciBsaW5rID0gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIHZhciBtYXA7XG4gICAgICAgIHZhciBjdXJyZW50X21hcF9udztcbiAgICAgICAgdmFyIGN1cnJlbnRfbWFwX3NlO1xuICAgICAgICBcbiAgICAgICAgdmFyIGltYWdlUG9zdCA9IHtcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vY2F0Y2htZS5pZnlvdWNhbi5jb20vaW1hZ2VzL3BpY3R1cmVzL0lZQ19JY29ucy9JWUNfTG9jYXRpb25fSWNvbl9TbWFsbC5wbmcnLFxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTAwLCAxMDApLFxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgxNywgMzQpLFxuICAgICAgICAgICAgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTcsIDI1KVxuICAgICAgICB9O1xuXG4gICAgICAgICB2YXIgaW1hZ2VUYXJnZXQgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vd3d3LmNsa2VyLmNvbS9jbGlwYXJ0cy9VL1Avai9NL0kvaS94LW1hcmsteWVsbG93LW1kLnBuZycsXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgxMDAsIDEwMCksXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDE3LCAzNCksXG4gICAgICAgICAgICBzY2FsZWRTaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyNSwgMjUpXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gbWFwIGNvbmZpZ1xuICAgICAgICBjb25zb2xlLmxvZygnd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSAnLCB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlICk7XG5cbiAgICAgICAgdmFyIGluaXRpYWxNYXBDZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDM0LjA1LCAtMTE4LjI0KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghaXNOYU4od2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSkgJiYgIWlzTmFOKHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlKSlcbiAgICAgICAge1xuICAgICAgICAgICAgaW5pdGlhbE1hcENlbnRlciA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcod2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSwgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJ3dpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgJywgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSApO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coaW5pdGlhbE1hcENlbnRlcik7XG5cbiAgICAgICAgdmFyIG1hcE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgY2VudGVyICAgICAgOiBpbml0aWFsTWFwQ2VudGVyLFxuICAgICAgICAgICAgICAgIHpvb20gICAgICAgIDogMTUsXG4gICAgICAgICAgICAgICAgTWFwVHlwZUlkICAgOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcbiAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbCA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGFuQ29udHJvbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgLy96b29tQ29udHJvbDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gZHJhdyBtYXAgd2l0aCBoZWxwZXIgbWFya2Vyc1xuICAgICAgICB2YXIgaGVscGVyTWFya2VycyA9IFtdO1xuICAgICAgICBmdW5jdGlvbiBkcmF3SGVscGVyTWFya2VyKGxvY2F0aW9uKXtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXJrZXI7IG1hcmtlciA9IGhlbHBlck1hcmtlcnNbaV07IGkrKykge1xuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzID0gW107XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGxvY2F0aW9uLCBcbiAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVRhcmdldFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUhlbHBlck1hcmtlcigpe1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1hcmtlcjsgbWFya2VyID0gaGVscGVyTWFya2Vyc1tpXTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhlbHBlck1hcmtlcnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBsb2NhdGlvbiBpbmZvcihsb24sbGF0KVxuICAgICAgICAgICAgc2NvcGUuJGVtaXQoJ2xvYycsIGxvY2F0aW9uKTtcblxuICAgICAgICAgICAgZHJhd0hlbHBlck1hcmtlcihsb2NhdGlvbik7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBwbGFjZSBmb3JtYXR0ZWRfYWRkcmVzcyBhbmQgZHJhdyBpY29uXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKCB7ICdsYXRMbmcnOiBsb2NhdGlvbiB9LCBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAvLyBhcyB1c2VyIGNsaWNrcyBvbiB0aGUgbWFwLFxuICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gc2F2ZSB0aGUgZm9ybWF0dGVkIGFkZHJlc3MgaW4gJHNjb3BlIGFuZFxuICAgICAgICAgICAgICAgIC8vIGl0IHdpbGwgYmUgdXNlZCB0aHJvdWdoIHBvc3RzLmN0cmxcbiAgICAgICAgICAgICAgICAvLyBlbWl0IGJyb2FkY2FzZSAncGxhY2UnIGFuZCBzZW5kIHRoaXMgdG8gYXBwbGljYXRpb24uY3RybFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBmb3JtYXR0ZWRfYWRkcmVzc1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZW1pdCgncGxhY2UnLCByZXN1bHRzWzFdLmZvcm1hdHRlZF9hZGRyZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKFwiXCIsXCJMb2NhdGlvbiBkb2VzIG5vdCBleGlzdHNcIik7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdwbGFjZScsIFwiTG9jYXRpb24gZG9lcyBub3QgZXhpc3RzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGxhY2UgYSBtYXJrZXIgYW5kIGluZm9XaW5kb3dcbiAgICAgICAgdmFyIG1hcmtlcnMgPSBbXTtcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTWFwKCkgeyAgIFxuICAgICAgICAgICAgUG9zdHNTdmMuZmV0Y2goKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xuXG4gICAgICAgICAgICAgICAgLy8gZHJhdyBsYXRlc3QgdXBkYXRlXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gcG9zdHNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIG1hcmtlcnMgcG9zdCBpcyBleGlzaXRpbmcgb25lLCB3ZSBkb24ndCB3YW50IHRvIGRyYXcgaXQgYWdhaW4uXG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgZHJhdyBuZXcgb25lcyFcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1tqXTsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3N0Ll9pZCA9PSBtYXJrZXIucG9zdC5faWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IG51bGw7IC8vIOydtOuvuCDqt7jroKTsp4Qg7Y+s7Iqk7Yq4652866m0LCBudWxs66GcLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyDsnbQgbG9vcOydgCBwb3N0Ll9pZOunjCDqsoDsgqzsmqnsnoTsnLzroZwsIOunjOyVvSDqsrnsuZjrqbQg67CU66GcIGxvb3DsnYQg66mI7Law64+EIOq0nOywruuLpC5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHBvc3TqsIAg7JuQ656YIOyeiOyXh+uNmOqyg+ydtOuptCBwb3N06rCAIG51bGzroZwg7IWLIOuQmOyXiOydhOqyg+ydtOqzoCwgbG9jYXRpb27tlITroZztjbzti7Drj4Qg7J6I64qU7KeAIO2ZleyduO2VmOyekFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc3QgfHwgIXBvc3QuaGFzT3duUHJvcGVydHkoJ2xvY2F0aW9uJykpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ29vZ2xlTG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbi5sYXQsIGxvY2F0aW9uLmxvbik7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyDrsJTsmrTrjZTrpqwg7JWI7JeQIOyeiOuKlOyngOu2gO2EsCDssrTtgazrpbwg7ZWY7J6lIFxuICAgICAgICAgICAgICAgICAgICBpZiAoIShnb29nbGVMb2MubGF0KCkgPCBjdXJyZW50X21hcF9udy5sYXQoKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEoZ29vZ2xlTG9jLmxhdCgpID4gY3VycmVudF9tYXBfc2UubGF0KCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAhKGdvb2dsZUxvYy5sbmcoKSA8IGN1cnJlbnRfbWFwX3NlLmxuZygpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIShnb29nbGVMb2MubG5nKCkgPiBjdXJyZW50X21hcF9udy5sbmcoKSkgKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFya2VyIG9wdGlvbiBzZXR0aW5nXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJrZXJPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGdvb2dsZUxvYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiQnViYmxlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVBvc3RcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIobWFya2VyT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdXAgc2VsZiByZW1vdmUgZm9yIG1hcmtlciBpdHNlbGYgYW5kIGZyb20gbWFya2VycyBjb2xsZWN0aW9uIGF0IGZyb250LWVuZFxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKG9sZF9tYXJrZXIsIG9sZF9wb3N0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkX21hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBtYXJrZXI7IG1hcmtlciA9IG1hcmtlcnNba107IGsrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkX3Bvc3QuX2lkID09IG1hcmtlci5wb3N0Ll9pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnNwbGljZShrLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfShtYXJrZXIsIHBvc3QpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0LmxpZmVzcGFuKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBtYXJrZXIgdG8gYXJyYXksIHRoaXMgbWVhbnMgdGhhdCBpdCBoYXMgYmVlbiBkcmF3biB0byBtYXBcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vycy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcjogbWFya2VyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgIDogcG9zdFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBEUkFXSU5HIE1FU1NBR0UgV0lORE9XIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBpZD1cImJ1YmJsZVBvc3RcIj4nICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QuYm9keSArIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+PGRpdiBpZD1cImJ1YmJsZUxpZmVCYXJcIj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIOyKpOy9lO2UhOyXkOyEnOu2gO2EsCDsg4jroZzsmrQg7LCo7J2865OcIOyKpOy9lO2UhOulvCDrp4zrk6TslrQgZWFjaCBmb3IgbG9vcOyXkOyEnCDsgqzsmqntlZzri6QuXG4gICAgICAgICAgICAgICAgICAgIC8vIC0tPiDtlbTslbwsIOqwgSBET03snbQg6rCB6rCB7J2YIHNjb3Bl66W8IOqwgOyguOyEnCBwb3N0IG1zZ+qwgCDslYgg6rK57Lmc64ukLlxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHBhcmVudC4kbmV3KHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcGVuSW5mb1dpbmRvdyA9IChmdW5jdGlvbihtYXJrZXIsIHNjb3BlLCBwb3N0bXNnLCBwb3N0bGlmZSl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgd2luZG93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9XaW5kb3dPcHRpb25zID0geyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl4ZWxPZmZzZXQ6IG5ldyBnb29nbGUubWFwcy5TaXplKC00MS41LCAxMC4wKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KGluZm9XaW5kb3dPcHRpb25zKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbXBpbGUgaXQgYmVmb3JlIGxvYWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gJzxkaXYgbWFwLW1zZz48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21waWxlZCA9ICRjb21waWxlKGNvbnRlbnQpKHNjb3BlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdG8gbWFrZSBkYXRhIGF2YWlsYWJsZSB0byB0ZW1wbGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1zZyA9IHBvc3Rtc2c7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucG9zdGxpZmUgPSBwb3N0bGlmZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudCggY29tcGlsZWRbMF0gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4obWFwICwgbWFya2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pKG1hcmtlciwgY2hpbGQsIHBvc3QuYm9keSwgcG9zdC5saWZlc3Bhbik7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBvcGVuSW5mb1dpbmRvdygpO1xuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEVORCBvZiBEUkFXSU5HIE1FU1NBR0UgV0lORE9XIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICAgICAgICAgIH0gLy8gZW5kIG9mIGZvci1sb29wXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldFNlYXJjaEJveCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgc2VhcmNoIGJveCBhbmQgbGluayBpdCB0byB0aGUgVUkgZWxlbWVudC5cbiAgICAgICAgICAgIHZhciBpbnB1dCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFjLWlucHV0JykpOyAvLyBAdHlwZSB7SFRNTElucHV0RWxlbWVudH0gIFxuICAgICAgICAgICAgdmFyIGN1cnJMb2NCdG4gPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1jdXJyJykpOyAgICAgIFxuICAgICAgICAgICAgbWFwLmNvbnRyb2xzW2dvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfTEVGVF0ucHVzaChpbnB1dCk7XG4gICAgICAgICAgICBtYXAuY29udHJvbHNbZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLlRPUF9SSUdIVF0ucHVzaChjdXJyTG9jQnRuKTtcblxuICAgICAgICAgICAgdmFyIHNlYXJjaEJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KChpbnB1dCkpOyAvLyBAdHlwZSB7SFRNTElucHV0RWxlbWVudH0gXG5cbiAgICAgICAgICAgIC8vIExpc3RlbiBmb3IgdGhlIGV2ZW50IGZpcmVkIHdoZW4gdGhlIHVzZXIgc2VsZWN0cyBhbiBpdGVtIGZyb20gdGhlXG4gICAgICAgICAgICAvLyBwaWNrIGxpc3QuIFJldHJpZXZlIHRoZSBtYXRjaGluZyBwbGFjZXMgZm9yIHRoYXQgaXRlbS5cbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHNlYXJjaEJveCwgJ3BsYWNlc19jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlcyA9IHNlYXJjaEJveC5nZXRQbGFjZXMoKTtcblxuICAgICAgICAgICAgICAgIGlmIChwbGFjZXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyB0YWtlIG9ubHkgMSBzcG90XG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlID0gcGxhY2VzWzBdO1xuXG4gICAgICAgICAgICAgICAgLy8gd2hlbiBzZWFyY2ggaGFwcGVucywgbG9jYXRpb24gd2lsbCBiZSB1cGRhdGVkIGFzIHdlbGwgZm9yIHBvc3RcbiAgICAgICAgICAgICAgICAvLyBzY29wZS4kZW1pdCgncGxhY2UnLCBwbGFjZS5mb3JtYXR0ZWRfYWRkcmVzcyk7XG4gICAgICAgICAgICAgICAgZHJhd0FuZFNldFBsYWNlKHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXRpdHVkZTtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSA9IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxvbmdpdHVkZTtcblxuICAgICAgICAgICAgICAgIG1hcC5wYW5UbyhwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgbWFwLnNldFpvb20oMTYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRDbGlja01hcCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIGNsaWNrIGV2ZW50IG9uIG1hcCB0byBkcmF3IG1hcmtlclxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShldmVudC5sYXRMbmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRNb3ZlVG9DdXJyZW50TG9jYXRpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBtb3ZpbmcgdG8gYSBwb3N0J3MgbG9jYXRpb24gYW5kIGRyYXcgYSBtYXJrZXIgdGhlcmVcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2hlYWRpbmdfY2hhbmdlZCcsIGZ1bmN0aW9uKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgZHJhd0FuZFNldFBsYWNlKGxvY2F0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0Q2VudGVyQ2hhbmdlZCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2NlbnRlcl9jaGFuZ2VkJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gbWFwLmdldENlbnRlcigpLmxhdCgpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlID0gbWFwLmdldENlbnRlcigpLmxuZygpO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlQm91bmRzKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0TWFwRHJhZ0VuZCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2RyYWdlbmQnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHVwZGF0ZU1hcCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJvdW5kcygpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBtYXAuZ2V0Qm91bmRzKCk7XG4gICAgICAgICAgICB2YXIgbmUgPSBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7IC8vIExhdExuZyBvZiB0aGUgbm9ydGgtZWFzdCBjb3JuZXJcbiAgICAgICAgICAgIHZhciBzdyA9IGJvdW5kcy5nZXRTb3V0aFdlc3QoKTsgLy8gTGF0TG5nIG9mIHRoZSBzb3V0aC13ZXN0IGNvcmRlclxuICAgICAgICAgICAgLy9Zb3UgZ2V0IG5vcnRoLXdlc3QgYW5kIHNvdXRoLWVhc3QgY29ybmVycyBmcm9tIHRoZSB0d28gYWJvdmU6XG5cbiAgICAgICAgICAgIGN1cnJlbnRfbWFwX253ID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhuZS5sYXQoKSwgc3cubG5nKCkpO1xuICAgICAgICAgICAgY3VycmVudF9tYXBfc2UgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN3LmxhdCgpLCBuZS5sbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIHNldExvYWRQb3N0TWFya2VycygpXG4gICAgICAgIHtcbiAgICAgICAgICAgIC8vIG1hbnVhbGx5IHJlbG9hZCBtYXJrZXJzIC8gUkVGUkVTSFxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZW1vdmVIZWxwZXJNYXJrZXIoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVNYXAoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaW5pdCB0aGUgbWFwXG4gICAgICAgIGZ1bmN0aW9uIGluaXRNYXAoKSB7XG4gICAgICAgICAgICBpZiAobWFwID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGVsZW1lbnRbMF0sIG1hcE9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZXRMb2FkUG9zdE1hcmtlcnMoKTtcblxuICAgICAgICAgICAgLy8gYnJvYWRjYXN0IHRvIHNlbmQgbWFwIHRvIGFwcGxpY2F0aW9uIGN0cmxcbiAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdtYXBJbml0JywgbWFwKTtcblxuICAgICAgICAgICAgc2V0Q2xpY2tNYXAoKTtcblxuICAgICAgICAgICAgc2V0U2VhcmNoQm94KCk7XG5cbiAgICAgICAgICAgIHNldENlbnRlckNoYW5nZWQoKTtcblxuICAgICAgICAgICAgc2V0TW92ZVRvQ3VycmVudExvY2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHNldE1hcERyYWdFbmQoKTtcblxuICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG5cbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdXBkYXRlQm91bmRzKCk7XG4gICAgICAgICAgICB9LCA4MDApO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gXG4gICAgICAgIGluaXRNYXAoKTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiBpZD1cIm1hcC1jYW52YXNcIj48L2Rpdj4nLFxuICAgICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgICBsaW5rOiBsaW5rXG4gICAgfTtcbn0pO1xuXG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmRpcmVjdGl2ZSgnbWFwTXNnJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RlbXBsYXRlcy93aW5kb3cuaHRtbCcsXG4gICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGF0dHJzKSB7ICAgICAgICBcbiAgICAgICAgdmFyIGR1cmF0aW9uID0gc2NvcGUucG9zdGxpZmUgKyBcIm1zXCI7XG5cbiAgICAgICAgLy8gYXMgdGVtcGxhdGVVcmwgRE9NIGlzIGxvYWRlZCwgdGhpcyBmdW5jdGlvbiB3aWxsIGdldCBjYWxsZWQuXG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJCgnZGl2IGRpdiAucG9zdGxpZmViYXInKS5jc3MoXCJhbmltYXRpb24tZHVyYXRpb25cIiwgZHVyYXRpb24pO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiSnF1ZXJ5IGNhbGxlZCA6XCIgKyAgZHVyYXRpb24gKyBcIiBhbmQgbXNnOlwiICsgc2NvcGUubXNnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgIH1cbiAgIH1cbn0pO1xuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHIuY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgUG9zdHNTdmMsICR3aW5kb3csICRkb2N1bWVudCl7XHJcclx0LyogZW1pdCBicm9hZGNhc3QgZm9yIGN1cnJlbnQgcGFnZUlkICovXHJcdCRzY29wZS4kZW1pdCgncGFnZWNoYW5nZScsICRzY29wZS5wYWdlSWQucG9zdCk7XHJcclx0JHNjb3BlLnBvc3RzID0gW107XHJcci8qIOqwleyVhOyngCBHRVTrlYwg7ZWE7JqU7ZaI7JeH7J2MLlxyXHQkc2NvcGUuJG9uKCdyZWZldGNoJywgZnVuY3Rpb24oXywgb2JqKXtcclx0XHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJcdH0pO1xyKi9cclx0XHJcdC8qIGFzIHNlcnZlciB0ZWxscyB0aGVyZSB3YXMgbmV3IHBvc3QsIGxldHMgcmUtbG9hZCBsaXN0IGRhdGEgKi9cclx0JHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KXtcclx0XHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJcdH0pO1xyXHJcdC8qIG1vdmUgdG8gcG9zdCdzIGxvY2F0aW9uICovXHJcdCRzY29wZS5tb3ZlVG9Mb2MgPSBmdW5jdGlvbihpZCl7XHJcdFx0dmFyIHBvc3QgPSAoJHNjb3BlLnBvc3RzW2lkXSk7XHJcclx0XHR2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xyXHRcdHZhciBnb29nbGVMb2MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxvY2F0aW9uLmxhdCwgbG9jYXRpb24ubG9uKTtcclxyXHRcdCRzY29wZS5tYXAucGFuVG8oZ29vZ2xlTG9jKTtcclx0XHQkc2NvcGUubWFwLnNldFpvb20oMTYpO1xyXHJcdFx0LyogdXNpbmcgYW5ndWxhci1zY3JvbGwgdG8gbW92ZSB0byB0aGUgdG9wIHNtb290aGx5ICovXHJcdFx0dmFyIHRvcCA9IDA7XHIgICAgXHR2YXIgZHVyYXRpb24gPSA0ODA7XHIgICAgXHQkZG9jdW1lbnQuc2Nyb2xsVG9wKHRvcCwgZHVyYXRpb24pLnRoZW4oZnVuY3Rpb24oKSB7XHIgICAgIFx0XHQgY29uc29sZSAmJiBjb25zb2xlLmxvZygnWW91IGp1c3Qgc2Nyb2xsZWQgdG8gdGhlIHRvcCEnKTtcciAgICBcdH0pO1xyXHJcdH07XHJcclx0JHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbigpIHtcclx0XHQvKiBnZXQgYXV0b2NvbXBsZXRlZCBwbGFjZSBhbmQgcmVzZXQoc2V0IHRvIHVuZGVmaW5lZCkgKi9cclx0XHR2YXIgcGxhY2UgPSAkc2NvcGUucG9zdHBsYWNlO1xyXHRcdHZhciBsb2NhdGlvbiA9ICRzY29wZS5wb3N0TG9jYXRpb247XHJcclx0XHR2YXIgbG9jYXRpb25KU09OID0gSlNPTi5zdHJpbmdpZnkobG9jYXRpb24pO1xyXHJcdFx0Y29uc29sZS5sb2coXCJQT1NUIGxvY2F0aW9uOlwiLCBsb2NhdGlvbkpTT04pO1xyXHRcdGNvbnNvbGUubG9nKFwiUE9TVCBwbGFjZTpcIiwgcGxhY2UpO1xyXHJcdFx0UG9zdHNTdmMuY3JlYXRlKFxyXHRcdHtcclx0XHRcdGJvZHkgICAgOiAkc2NvcGUuY29udGVudCxcclx0XHRcdGxvY2F0aW9uOiBsb2NhdGlvbkpTT04sXHJcdFx0XHRwbGFjZSAgIDogcGxhY2Vcclx0XHR9KVxyXHRcdC5zdWNjZXNzKGZ1bmN0aW9uKHBvc3Qpe1xyXHRcdFx0LyogbWFudWFsbHkgcmVsb2FkIG1hcmtlcnMgXHJcdFx0XHR1c2luZyBtYXB0eXBlaWQgc2luY2UgaXRzIG1vc3QgbGVhc3QgdXNlZCBldmVudCwgLSBraW5kIG9mIGhhY2t5IHdheSB0byBkbyBpdFxyXHRcdFx0Ki9cclx0XHRcdGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIoJHNjb3BlLm1hcCwgJ21hcHR5cGVpZF9jaGFuZ2VkJyk7XHJcclx0XHRcdCRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpO1xyXHJcdFx0XHRjb25zb2xlLmxvZyhcInBvc3QgaGFzIGJlZW4gcG9zdHNlZC4gcmVhZHkgZm9yIGRlbGV0ZVwiKTtcclxyXHRcdFx0LyogZnJvbnQgZW5kIHNpZGUgbGlzdCBwb3N0IHJlbW92ZSAqL1xyXHRcdFx0dmFyIGZyb250RW5kUG9zdFJlbW92ZSA9IGZ1bmN0aW9uKCl7IFxyXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5wb3N0cy5sZW5ndGg7ICsraSl7XHJcdFx0XHRcdGlmIChwb3N0Ll9pZCA9PSAkc2NvcGUucG9zdHNbaV0uX2lkKVxyXHRcdFx0XHRcdCRzY29wZS5wb3N0cy5zcGxpY2UoaSwgMSk7XHJcdFx0XHRcdH1cclx0XHRcdH07XHJcdFx0XHRzZXRUaW1lb3V0KGZyb250RW5kUG9zdFJlbW92ZSwgcG9zdC5saWZlc3Bhbik7XHJcclx0XHRcdC8qIHJlc2V0IGlucHV0IGZvcm1zICovXHJcdFx0XHQkc2NvcGUuY29udGVudCAgPSBudWxsO1xyXHRcdH0pXHJcdFx0LmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cyl7XHJcdFx0XHRzd2FsKFwiUG9zdCBmYWlsZWRcIiwgXCJQbGVhc2UgY29tcGxldGUgdGhlIGZyb20gY29ycmVjdGx5XCIsIFwiZXJyb3JcIik7XHJcdFx0fSk7XHJcclx0fTtcclxyXHQvKiBhcyBzZXJ2ZXIgdGVsbHMgdGhlcmUgd2FzIG5ldyBwb3N0LCBsZXRzIHJlLWxvYWQgbGlzdCBkYXRhICovXHJcdCRzY29wZS5yZXF1ZXN0RmV0Y2ggPSBmdW5jdGlvbigpIHtcclx0XHRQb3N0c1N2Yy5mZXRjaCgpXHJcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xyXHRcdFx0Y29uc29sZS5sb2coJ1Bvc3RzIGhhdmUgYmVlbiBsb2FkZWQgc3VjY2Vzc2Z1bGx5IGZvciBmcm9udCBwYWdlJyk7XHJcdFx0XHQkc2NvcGUucG9zdHMgPSBwb3N0cztcclx0XHR9KTtcclx0fTtcclxyXHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJ9KTtcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnUG9zdHNTdmMnLCBmdW5jdGlvbigkaHR0cCl7XG5cdHRoaXMuZmV0Y2ggPSBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcG9zdHMnKTtcblx0fTtcblxuXHR0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHBvc3Qpe1xuXHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdH07XG5cblx0dGhpcy5yZW1vdmUgPSBmdW5jdGlvbihwb3N0KXtcblx0XHRjb25zb2xlLmxvZyhcImRlbGV0aW5nIHBvc3RpbmdcIik7XG5cdFx0Y29uc29sZS5sb2coJ3Bvc3QuX2lkOicsIHBvc3QuX2lkKTtcblx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL3Bvc3RzJywgcG9zdCk7XG5cdH07XG59KTtcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCl7XG5cdHZhciB1cmw7XG5cblx0dmFyIGhvc3RuYW1lID0gZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWU7XG5cdFxuXHR2YXIgZGV2ZWxvcG1lbnRJUCA9IFwiMTkyLjE2OC4wLjRcIjtcblxuXHRpZiAoaG9zdG5hbWUgPT0gXCJsb2NhbGhvc3RcIiB8fCBob3N0bmFtZSA9PSBkZXZlbG9wbWVudElQKSB7XG5cdFx0dXJsID0gJ3dzOi8vMTkyLjE2OC4wLjQ6NTAwMCc7IC8vIGRldmVsb3BtZXQgb24gc29ja2V0IGxvY2FsbHkgXG5cdH1cblx0ZWxzZSB7XG5cdFx0dXJsID0gJ3dzczovL2Zyb3plbi1iYWRsYW5kcy04NjQ5Lmhlcm9rdWFwcC5jb20nOyAvLyBwcm9kdWN0aW9uIGRlcGxveSB2ZXJzaW9uIC0gc3RpbGwgZGVidWcgbW9kZVxuXHR9XG5cdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xuXG5cdHZhciByZWNvbm5lY3QgPWZ1bmN0aW9uKCl7XG5cdFx0Y29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcblx0fVxuXG5cdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29uZWN0aW5nLi4uJyk7XG5cdFx0JHRpbWVvdXQocmVjb25uZWN0LCAxMCoxMDAwMCk7XG5cdH07XG5cblx0Y29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKXtcblx0XHRjb25zb2xlLmxvZyhlKTtcblx0XHR2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZS5kYXRhKTtcblx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3dzOicgKyBwYXlsb2FkLnR5cGUsIHBheWxvYWQuZGF0YSk7XG5cdH1cbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCl7XG5cdHZhciB1cmw7XG5cblx0dmFyIGhvc3RuYW1lID0gZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWU7XG5cdFxuXHR2YXIgZGV2ZWxvcG1lbnRJUCA9IFwiMTkyLjE2OC4wLjRcIjtcblxuXHRpZiAoaG9zdG5hbWUgPT0gXCJsb2NhbGhvc3RcIiB8fCBob3N0bmFtZSA9PSBkZXZlbG9wbWVudElQKSB7XG5cdFx0dXJsID0gJ3dzOi8vMTkyLjE2OC4wLjQ6NTAwMCc7IC8vIGRldmVsb3BtZXQgb24gc29ja2V0IGxvY2FsbHkgXG5cdH1cblx0ZWxzZSB7XG5cdFx0dXJsID0gJ3dzczovL2Zyb3plbi1iYWRsYW5kcy04NjQ5Lmhlcm9rdWFwcC5jb20nOyAvLyBwcm9kdWN0aW9uIGRlcGxveSB2ZXJzaW9uIC0gc3RpbGwgZGVidWcgbW9kZVxuXHR9XG5cdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xuXG5cdHZhciByZWNvbm5lY3QgPWZ1bmN0aW9uKCl7XG5cdFx0Y29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcblx0fVxuXG5cdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29uZWN0aW5nLi4uJyk7XG5cdFx0JHRpbWVvdXQocmVjb25uZWN0LCAxMCoxMDAwMCk7XG5cdH07XG5cblx0Y29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKXtcblx0XHRjb25zb2xlLmxvZyhlKTtcblx0XHR2YXIgcGF5bG9hZCA9IEpTT04ucGFyc2UoZS5kYXRhKTtcblx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3dzOicgKyBwYXlsb2FkLnR5cGUsIHBheWxvYWQuZGF0YSk7XG5cdH1cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==