angular.module("app",["ngRoute","duScroll"]),angular.module("app").controller("ApplicationCtrl",["$rootScope","$scope","$window","$http",function(o,e,t,n){e.pageId={post:0},e.navCollapsed=!0,e.collapse=function(){e.navCollapsed=!0},e.$on("ws:new_post",function(o,t){google.maps.event.trigger(e.map,"maptypeid_changed")}),e.moveToCurrentLocation=function(){function o(o){if(e.currentPageId==e.pageId.post){var t=o.coords;window.localStorage.latitude=t.latitude,window.localStorage.longitude=t.longitude;var n=new google.maps.LatLng(t.latitude,t.longitude);google.maps.event.trigger(e.map,"heading_changed",n),e.map.panTo(n),e.map.setZoom(15)}}function t(o){console.warn("ERROR("+o.code+"): "+o.message)}navigator.geolocation.getCurrentPosition(o,t),swal({title:"",text:"Moving to current location..",timer:1500,showConfirmButton:!1})},e.$on("pagechange",function(o,t){e.currentPageId=t}),e.$on("loc",function(o,t){console.log("IN:",t);var n=t.lat(),a=t.lng();e.postLocation={lat:n,lon:a},console.log("SAVED:",e.postLocation)}),e.$on("place",function(o,t){e.$apply(function(){e.postplace=t,console.log("SAVED:",e.postplace)})}),e.$on("mapInit",function(o,t){e.map=t,google.maps.event.trigger(e.map,"center_changed")})}]),angular.module("app").config(["$routeProvider",function(o){o.when("/",{controller:"PostsCtrl",templateUrl:"/templates/posts.html"}).otherwise({redirectTo:"/"})}]),angular.module("app").service("UtilSvc",function(){var o=this;o.deg2rad=function(o){return o*(Math.PI/180)},o.getDistanceFromLatLonInKm=function(e,t,n,a){var l=6371,i=o.deg2rad(n-e),s=o.deg2rad(a-t),c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(o.deg2rad(e))*Math.cos(o.deg2rad(n))*Math.sin(s/2)*Math.sin(s/2),r=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),g=l*r;return g}}),angular.module("app").directive("appMap",["PostsSvc","UtilSvc","$compile","$timeout",function(o,e,t,n){var a=function(e,a,l){function i(o){for(var e,t=0;e=M[t];t++)e.setMap(null);M=[];var e=new google.maps.Marker({position:o,map:h,icon:$});M.push(e)}function s(){for(var o,e=0;o=M[e];e++)o.setMap(null);M=[]}function c(o){var t=new google.maps.Geocoder;e.$emit("loc",o),i(o),t.geocode({latLng:o},function(o,t){try{e.$emit("place",o[1].formatted_address)}catch(n){console.log(n),swal("","Location does not exists"),e.$emit("place","Location does not exists")}})}function r(){o.fetch().success(function(o){for(var n=0;n<o.length;n++){for(var a,l=o[n],i=0;a=I[i];i++)if(l._id==a.post._id){l=null;break}if(l&&l.hasOwnProperty("location")){var s=angular.fromJson(l.location),c=new google.maps.LatLng(s.lat,s.lon);if(c.lat()<S.lat()&&c.lat()>L.lat()&&c.lng()<L.lng()&&c.lng()>S.lng()){var r={position:c,map:h,title:"Bubble",icon:P},a=new google.maps.Marker(r);setTimeout(function(o,e){return function(){o.setMap(null);for(var t,n=0;t=I[n];n++)e._id==t.post._id&&I.splice(n,1)}}(a,l),l.lifespan),I.push({marker:a,post:l});var g=e,p=g.$new(!0),u=function(o,e,n,a){return function(){var l={pixelOffset:new google.maps.Size(-41.5,10)},i=new google.maps.InfoWindow(l),s="<div map-msg></div>",c=t(s)(e);e.msg=n,e.postlife=a,i.setContent(c[0]),i.open(h,o)}}(a,p,l.body,l.lifespan);u()}}}})}function g(){var o=document.getElementById("pac-input"),e=document.getElementById("btn-curr");h.controls[google.maps.ControlPosition.TOP_LEFT].push(o),h.controls[google.maps.ControlPosition.TOP_RIGHT].push(e);var t=new google.maps.places.SearchBox(o);google.maps.event.addListener(t,"places_changed",function(){var o=t.getPlaces();if(0!=o.length){var e=o[0];c(e.geometry.location),window.localStorage.latitude=e.geometry.location.latitude,window.localStorage.longitude=e.geometry.location.longitude,h.panTo(e.geometry.location),h.setZoom(16)}})}function p(){google.maps.event.addListener(h,"click",function(o){c(o.latLng)})}function u(){google.maps.event.addListener(h,"heading_changed",function(o){c(o)})}function d(){google.maps.event.addListener(h,"center_changed",function(){window.localStorage.latitude=h.getCenter().lat(),window.localStorage.longitude=h.getCenter().lng(),f()})}function m(){google.maps.event.addListener(h,"dragend",function(){r()})}function f(){var o=h.getBounds(),e=o.getNorthEast(),t=o.getSouthWest();S=new google.maps.LatLng(e.lat(),t.lng()),L=new google.maps.LatLng(t.lat(),e.lng())}function w(){google.maps.event.addListener(h,"maptypeid_changed",function(){s(),r()})}function v(){void 0===h&&(h=new google.maps.Map(a[0],_)),w(),e.$emit("mapInit",h),p(),g(),d(),u(),m(),r(),n(function(){f()},800)}var h,S,L,P={url:"https://catchme.ifyoucan.com/images/pictures/IYC_Icons/IYC_Location_Icon_Small.png",size:new google.maps.Size(100,100),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(17,25)},$={url:"http://www.clker.com/cliparts/U/P/j/M/I/i/x-mark-yellow-md.png",size:new google.maps.Size(100,100),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};console.log("window.localStorage.latitude ",window.localStorage.latitude);var y=new google.maps.LatLng(34.05,-118.24);isNaN(window.localStorage.latitude)||isNaN(window.localStorage.longitude)||(y=new google.maps.LatLng(window.localStorage.latitude,window.localStorage.longitude)),console.log("window.localStorage.latitude ",window.localStorage.latitude),console.log(y);var _={center:y,zoom:15,MapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,streetViewControl:!1},M=[],I=[];v()};return{restrict:"A",template:'<div id="map-canvas"></div>',replace:!0,link:a}}]),angular.module("app").directive("mapMsg",function(){return{restrict:"A",templateUrl:"./templates/window.html",link:function(o,e){var t=o.postlife+"ms";angular.element(document).ready(function(){$("div div .postlifebar").css("animation-duration",t),console.log("Jquery called :"+t+" and msg:"+o.msg)})}}}),angular.module("app").controller("PostsCtrl",["$scope","PostsSvc","$window","$document",function(o,e,t,n){o.$emit("pagechange",o.pageId.post),o.posts=[],o.$on("ws:new_post",function(e,t){o.requestFetch()}),o.moveToLoc=function(e){var t=o.posts[e],a=angular.fromJson(t.location),l=new google.maps.LatLng(a.lat,a.lon);o.map.panTo(l),o.map.setZoom(16);var i=0,s=480;n.scrollTop(i,s).then(function(){console&&console.log("You just scrolled to the top!")})},o.addPost=function(){var t=o.postplace,n=o.postLocation,a=JSON.stringify(n);console.log("POST location:",a),console.log("POST place:",t),e.create({body:o.content,location:a,place:t}).success(function(e){google.maps.event.trigger(o.map,"maptypeid_changed"),o.posts.unshift(e),console.log("post has been postsed. ready for delete");var t=function(){for(var t=0;t<o.posts.length;++t)e._id==o.posts[t]._id&&o.posts.splice(t,1)};setTimeout(t,e.lifespan),o.content=null}).error(function(o,e){swal("Post failed","Please complete the from correctly","error")})},o.requestFetch=function(){e.fetch().success(function(e){console.log("Posts have been loaded successfully for front page"),o.posts=e})},o.requestFetch()}]),angular.module("app").service("PostsSvc",["$http",function(o){this.fetch=function(){return o.get("/api/posts")},this.create=function(e){return o.post("/api/posts",e)},this.remove=function(e){return console.log("deleting posting"),console.log("post._id:",e._id),o.put("/api/posts",e)}}]),angular.module("app").run(["$rootScope","$timeout",function(o,e){var t="ws://frozen-badlands-8649.herokuapp.com",n=new WebSocket(t);n.onopen=function(){console.log("WebSocket connected")},n.onclose=function(){console.log("WebSocket closed. Reconecting..."),e(connect,1e5)},n.onmessage=function(e){console.log(e);var t=JSON.parse(e.data);o.$broadcast("ws:"+t.type,t.data)}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1dGlsLnN2Yy5qcyIsIm1hcHMvbWFwLmRpcmVjdGl2ZS5qcyIsIm1hcHMvbXNnLmRpcmVjdGl2ZS5qcyIsInBvc3RzL3Bvc3RzLmN0cmwuanMiLCJwb3N0cy9wb3N0cy5zdmMuanMiLCJhcHAuanMiLCJzb2NrZXRzL3dlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcm9vdFNjb3BlIiwiJHNjb3BlIiwiJHdpbmRvdyIsIiRodHRwIiwicGFnZUlkIiwicG9zdCIsIm5hdkNvbGxhcHNlZCIsImNvbGxhcHNlIiwiJG9uIiwiXyIsImdvb2dsZSIsIm1hcHMiLCJldmVudCIsInRyaWdnZXIiLCJtYXAiLCJtb3ZlVG9DdXJyZW50TG9jYXRpb24iLCJnZXRDdXJyTG9jU3VjY2VzcyIsInBvcyIsImN1cnJlbnRQYWdlSWQiLCJjcmQiLCJjb29yZHMiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImdvb2dsZUxvYyIsIkxhdExuZyIsInBhblRvIiwic2V0Wm9vbSIsImdldEN1cnJMb2NFcnJvciIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiY29kZSIsIm1lc3NhZ2UiLCJuYXZpZ2F0b3IiLCJnZW9sb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsInN3YWwiLCJ0aXRsZSIsInRleHQiLCJ0aW1lciIsInNob3dDb25maXJtQnV0dG9uIiwibG9jYXRpb24iLCJsb2ciLCJsYXQiLCJsb24iLCJsbmciLCJwb3N0TG9jYXRpb24iLCJwbGFjZSIsIiRhcHBseSIsInBvc3RwbGFjZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInNlcnZpY2UiLCJzdmMiLCJ0aGlzIiwiZGVnMnJhZCIsImRlZyIsIk1hdGgiLCJQSSIsImdldERpc3RhbmNlRnJvbUxhdExvbkluS20iLCJsYXQxIiwibG9uMSIsImxhdDIiLCJsb24yIiwiUiIsImRMYXQiLCJkTG9uIiwiYSIsInNpbiIsImNvcyIsImMiLCJhdGFuMiIsInNxcnQiLCJkIiwiZGlyZWN0aXZlIiwiUG9zdHNTdmMiLCJVdGlsU3ZjIiwiJGNvbXBpbGUiLCIkdGltZW91dCIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImRyYXdIZWxwZXJNYXJrZXIiLCJtYXJrZXIiLCJpIiwiaGVscGVyTWFya2VycyIsInNldE1hcCIsIk1hcmtlciIsInBvc2l0aW9uIiwiaWNvbiIsImltYWdlVGFyZ2V0IiwicHVzaCIsInJlbW92ZUhlbHBlck1hcmtlciIsImRyYXdBbmRTZXRQbGFjZSIsImdlb2NvZGVyIiwiR2VvY29kZXIiLCIkZW1pdCIsImdlb2NvZGUiLCJsYXRMbmciLCJyZXN1bHRzIiwic3RhdHVzIiwiZm9ybWF0dGVkX2FkZHJlc3MiLCJ1cGRhdGVNYXAiLCJmZXRjaCIsInN1Y2Nlc3MiLCJwb3N0cyIsImxlbmd0aCIsImoiLCJtYXJrZXJzIiwiX2lkIiwiaGFzT3duUHJvcGVydHkiLCJmcm9tSnNvbiIsImN1cnJlbnRfbWFwX253IiwiY3VycmVudF9tYXBfc2UiLCJtYXJrZXJPcHRpb25zIiwiaW1hZ2VQb3N0Iiwic2V0VGltZW91dCIsIm9sZF9tYXJrZXIiLCJvbGRfcG9zdCIsImsiLCJzcGxpY2UiLCJsaWZlc3BhbiIsInBhcmVudCIsImNoaWxkIiwiJG5ldyIsIm9wZW5JbmZvV2luZG93IiwicG9zdG1zZyIsInBvc3RsaWZlIiwiaW5mb1dpbmRvd09wdGlvbnMiLCJwaXhlbE9mZnNldCIsIlNpemUiLCJpbmZvV2luZG93IiwiSW5mb1dpbmRvdyIsImNvbnRlbnQiLCJjb21waWxlZCIsIm1zZyIsInNldENvbnRlbnQiLCJvcGVuIiwiYm9keSIsInNldFNlYXJjaEJveCIsImlucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN1cnJMb2NCdG4iLCJjb250cm9scyIsIkNvbnRyb2xQb3NpdGlvbiIsIlRPUF9MRUZUIiwiVE9QX1JJR0hUIiwic2VhcmNoQm94IiwicGxhY2VzIiwiU2VhcmNoQm94IiwiYWRkTGlzdGVuZXIiLCJnZXRQbGFjZXMiLCJnZW9tZXRyeSIsInNldENsaWNrTWFwIiwic2V0TW92ZVRvQ3VycmVudExvY2F0aW9uIiwic2V0Q2VudGVyQ2hhbmdlZCIsImdldENlbnRlciIsInVwZGF0ZUJvdW5kcyIsInNldE1hcERyYWdFbmQiLCJib3VuZHMiLCJnZXRCb3VuZHMiLCJuZSIsImdldE5vcnRoRWFzdCIsInN3IiwiZ2V0U291dGhXZXN0Iiwic2V0TG9hZFBvc3RNYXJrZXJzIiwiaW5pdE1hcCIsIk1hcCIsIm1hcE9wdGlvbnMiLCJ1cmwiLCJzaXplIiwib3JpZ2luIiwiUG9pbnQiLCJhbmNob3IiLCJzY2FsZWRTaXplIiwiaW5pdGlhbE1hcENlbnRlciIsImlzTmFOIiwiY2VudGVyIiwiem9vbSIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJzY3JvbGx3aGVlbCIsInN0cmVldFZpZXdDb250cm9sIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsInJlcGxhY2UiLCJkdXJhdGlvbiIsInJlYWR5IiwiJCIsImNzcyIsIiRkb2N1bWVudCIsInJlcXVlc3RGZXRjaCIsIm1vdmVUb0xvYyIsImlkIiwidG9wIiwic2Nyb2xsVG9wIiwidGhlbiIsImFkZFBvc3QiLCJsb2NhdGlvbkpTT04iLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlIiwidW5zaGlmdCIsImZyb250RW5kUG9zdFJlbW92ZSIsImVycm9yIiwiZGF0YSIsImdldCIsInJlbW92ZSIsInB1dCIsInJ1biIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbmNsb3NlIiwiY29ubmVjdCIsIm9ubWVzc2FnZSIsImUiLCJwYXlsb2FkIiwicGFyc2UiLCIkYnJvYWRjYXN0IiwidHlwZSJdLCJtYXBwaW5ncyI6IkFBQ0FBLFFBQUFDLE9BQUEsT0FDQSxVQUNBLGFDRkFE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QUthLElBQUEsWUFBa0J2QyxFQUFLK0csS0FDcEJqSCxFQUFNcU4sSUFBQSxhQUFLbk4sT0FHcEJSLFFBQU1DLE9BQVMsT0FDZDJOLEtBQUMsYUFBWSxXQUFBLFNBQUF6TixFQUFBb0YsR0FFYixHQUFDNkYsR0FBTywwQ0FDSnlDLEVBQWEsR0FBSUMsV0FBVTFDLEVBRWhDeUMsR0FBUUUsT0FBTyxXQUNkN0wsUUFBQWEsSUFBQSx3QkFHQThLLEVBQUlHLFFBQWlCLFdBQ3BCOUwsUUFBUWEsSUFBSSxvQ0FDYndDLEVBQUEwSSxRQUFXLE1BR1hKLEVBQVdLLFVBQVksU0FBU0MsR0FDaENqTSxRQUFBYSxJQUFXb0wsRUFDVixJQUFBQyxHQUFZbEIsS0FBQW1CLE1BQUFGLEVBQUFYLEtBQ1pyTixHQUFTbU8sV0FBWSxNQUFBRixFQUFBRyxLQUFBSCxFQUFBWiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG5cdCduZ1JvdXRlJyxcblx0J2R1U2Nyb2xsJ1xuXSk7XG4iLCJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJHdpbmRvdywgJGh0dHApe1xuXHQkc2NvcGUucGFnZUlkID0geyBcblx0XHRwb3N0IDogMCxcblx0fTtcblxuXHQkc2NvcGUubmF2Q29sbGFwc2VkID0gdHJ1ZTtcblx0JHNjb3BlLmNvbGxhcHNlID0gZnVuY3Rpb24oKXtcblx0XHQkc2NvcGUubmF2Q29sbGFwc2VkID0gdHJ1ZTtcblx0fTtcblxuXHQvKlxuXHQvLyDqsJXslYTsp4Ag6rKf7Jy866GcIOuntSDsl4XrjbDsnbTtirjrpbwg7ZWY64qUIOuwqeyLnS5cblx0JHNjb3BlLnJlcXVlc3RSZWZyZXNoID0gZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3JlZnJlc2gnKVxuXHRcdC50aGVuKFxuXHRcdGZ1bmN0aW9uKHJlcyl7XG5cdFx0XHRjb25zb2xlLmxvZyhcIk9LQVksIHNlcnZlciBzYXlzIHdlIHVwZGF0ZSB0aGUgbWFwIVwiKTtcblxuXHRcdFx0JHNjb3BlLiRlbWl0KCdyZWZldGNoJywge30pOyAvLyB0byB1cGRhdGUgbGlzdFxuXHRcdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnKTsgLy8gdG8gdXBkYXRlIG1hcFxuXG5cdFx0XHQkc2NvcGUucmVxdWVzdFJlZnJlc2goKTtcblx0XHR9LFxuXHRcdGZ1bmN0aW9uKGVycil7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkVycm9yIHNob3VsZCBub3QgaGFwcGVuIGZvciB0aGlzLi46XCIsIGVycik7XG5cdFx0fSk7XG5cdH1cblx0JHNjb3BlLnJlcXVlc3RSZWZyZXNoKCk7XG5cdCovXG5cblx0Ly8gYXMgc2VydmVyIHNvY2tldCBzZW5kICd3czpuZXdfcG9zdCcgLCB3ZSBjYW4gdXBkYXRlIHRoZSBtYXAhXG5cdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCl7XG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnKTtcblx0fSk7XG5cblx0LyogbW92ZSB0byBjdXJyZW50IGxvY2F0aW9uICovXG5cdCRzY29wZS5tb3ZlVG9DdXJyZW50TG9jYXRpb24gPSBmdW5jdGlvbigpe1xuXHRcdGZ1bmN0aW9uIGdldEN1cnJMb2NTdWNjZXNzKHBvcykge1xuICAgICAgICAgICAgLyogbWFrZSBzdXJlIHRvIGNoZWNrIHdlIGFyZSBvbiBwb3N0IHBhZ2Ugd2l0aCBtYXAgZmlyc3QgKi9cbiAgICAgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2VJZCAhPSAkc2NvcGUucGFnZUlkLnBvc3QpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICB2YXIgY3JkID0gcG9zLmNvb3JkcztcblxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSA9IGNyZC5sYXRpdHVkZTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlID0gY3JkLmxvbmdpdHVkZTtcblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTGF0aXR1ZGUgOiAnICsgY3JkLmxhdGl0dWRlKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0xvbmdpdHVkZTogJyArIGNyZC5sb25naXR1ZGUpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTW9yZSBvciBsZXNzICcgKyBjcmQuYWNjdXJhY3kgKyAnIG1ldGVycy4nKTtcbiAgICAgICAgICAgIHZhciBnb29nbGVMb2MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGNyZC5sYXRpdHVkZSwgY3JkLmxvbmdpdHVkZSk7XG5cbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIoJHNjb3BlLm1hcCwgJ2hlYWRpbmdfY2hhbmdlZCcsIGdvb2dsZUxvYyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5tYXAucGFuVG8oZ29vZ2xlTG9jKVxuICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRab29tKDE1KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEN1cnJMb2NFcnJvcihlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRVJST1IoJyArIGVyci5jb2RlICsgJyk6ICcgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKiBpbml0IG1hcCBhbmQgcGxhY2Ugc29tZSBtYXJrZXJzLCBzbyBldmVyeXRoaW5nIHN0YXJ0IHdpdGggdGhpcyBmdW5jdGlvbi4gKi9cbiAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihnZXRDdXJyTG9jU3VjY2VzcywgZ2V0Q3VyckxvY0Vycm9yKTtcblxuICAgICAgICBzd2FsKHsgICB0aXRsZTogXCJcIiwgICB0ZXh0OiBcIk1vdmluZyB0byBjdXJyZW50IGxvY2F0aW9uLi5cIiwgICB0aW1lcjogMTUwMCwgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7XG5cdH07XG5cblx0JHNjb3BlLiRvbigncGFnZWNoYW5nZScsIGZ1bmN0aW9uKF8sIHBhZ2VJZCl7XG5cdFx0JHNjb3BlLmN1cnJlbnRQYWdlSWQgPSBwYWdlSWQ7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ2xvYycsIGZ1bmN0aW9uKF8sIGxvY2F0aW9uKXtcblx0XHRjb25zb2xlLmxvZygnSU46Jyxsb2NhdGlvbik7XG5cdFx0dmFyIGxhdCA9IGxvY2F0aW9uLmxhdCgpO1xuXHRcdHZhciBsb24gPSBsb2NhdGlvbi5sbmcoKTtcblx0XHQkc2NvcGUucG9zdExvY2F0aW9uID0ge1xuXHRcdFx0bGF0OiBsYXQsXG5cdFx0XHRsb246IGxvblxuXHRcdH07XG5cdFx0Y29uc29sZS5sb2coJ1NBVkVEOicsICRzY29wZS5wb3N0TG9jYXRpb24pO1xuXHR9KTtcblxuXHQkc2NvcGUuJG9uKCdwbGFjZScsIGZ1bmN0aW9uKF8sIHBsYWNlKXtcblx0XHQvLyBGb3JjaW5nIHRoZSB1cGRhdGUgd2l0aCAkYXBwbHkoKSBtZXRob2Qgb24gJHNjb3BlXG5cdFx0Ly8gcHJvYmxlbSByZWxhdGVkIG5vdGU6IGh0dHA6Ly93d3cuamVmZnJ5aG91c2VyLmNvbS9pbmRleC5jZm0vMjAxNC82LzIvSG93LWRvLUktcnVuLWNvZGUtd2hlbi1hLXZhcmlhYmxlLWNoYW5nZXMtd2l0aC1Bbmd1bGFySlNcblx0XHQkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdCRzY29wZS5wb3N0cGxhY2UgPSBwbGFjZTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ1NBVkVEOicsICRzY29wZS5wb3N0cGxhY2UpO1xuXHRcdFx0fVxuXHRcdCk7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ21hcEluaXQnLCBmdW5jdGlvbihfLCBtYXApe1xuXHRcdCRzY29wZS5tYXAgPSBtYXA7XG5cdFx0XG5cdFx0Ly8gdXBkYXRlIG1hcCBib3VuZHMgYXMgYXBwIGxhdW5jaGVzXG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnY2VudGVyX2NoYW5nZWQnKTtcblx0fSk7XG5cbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIpe1xuXHQkcm91dGVQcm92aWRlclxuXHQud2hlbignLycsIFxuXHRcdHtcblx0XHRcdGNvbnRyb2xsZXI6ICdQb3N0c0N0cmwnLCBcblx0XHRcdHRlbXBsYXRlVXJsOiAnL3RlbXBsYXRlcy9wb3N0cy5odG1sJ1xuXHRcdH0pXG5cdC8vIFJlZGlyZWN0IHRvIHRoZSByb290IHBhZ2UuXG5cdC5vdGhlcndpc2UoXG5cdFx0e1xuICAgXHRcdFx0cmVkaXJlY3RUbzogJy8nXG5cdFx0fSk7XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1V0aWxTdmMnLCBmdW5jdGlvbigpe1xuXHR2YXIgc3ZjID0gdGhpcztcblxuXHRzdmMuZGVnMnJhZCA9IGZ1bmN0aW9uKGRlZykge1xuXHQgIHJldHVybiBkZWcgKiAoTWF0aC5QSS8xODApO1xuXHR9O1xuXG5cdHN2Yy5nZXREaXN0YW5jZUZyb21MYXRMb25JbkttID0gZnVuY3Rpb24gKGxhdDEsbG9uMSxsYXQyLGxvbjIpIHtcblx0ICB2YXIgUiA9IDYzNzE7XG5cdCAgdmFyIGRMYXQgPSBzdmMuZGVnMnJhZChsYXQyLWxhdDEpO1xuXHQgIHZhciBkTG9uID0gc3ZjLmRlZzJyYWQobG9uMi1sb24xKTsgXG5cdCAgdmFyIGEgPSBcblx0ICAgIE1hdGguc2luKGRMYXQvMikgKiBNYXRoLnNpbihkTGF0LzIpICtcblx0ICAgIE1hdGguY29zKHN2Yy5kZWcycmFkKGxhdDEpKSAqIE1hdGguY29zKHN2Yy5kZWcycmFkKGxhdDIpKSAqIFxuXHQgICAgTWF0aC5zaW4oZExvbi8yKSAqIE1hdGguc2luKGRMb24vMilcblx0ICAgIDsgXG5cdCAgdmFyIGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxLWEpKTsgXG5cdCAgdmFyIGQgPSBSICogYztcblx0ICByZXR1cm4gZDtcblx0fTtcbn0pOyIsIlxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uZGlyZWN0aXZlKCdhcHBNYXAnLCBmdW5jdGlvbihQb3N0c1N2YywgVXRpbFN2YywgJGNvbXBpbGUsICR0aW1lb3V0KSB7XG4gICAgLy8gZGlyZWN0aXZlIGxpbmsgZnVuY3Rpb25cbiAgICB2YXIgbGluayA9IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICB2YXIgbWFwO1xuICAgICAgICB2YXIgY3VycmVudF9tYXBfbnc7XG4gICAgICAgIHZhciBjdXJyZW50X21hcF9zZTtcbiAgICAgICAgXG4gICAgICAgIHZhciBpbWFnZVBvc3QgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2NhdGNobWUuaWZ5b3VjYW4uY29tL2ltYWdlcy9waWN0dXJlcy9JWUNfSWNvbnMvSVlDX0xvY2F0aW9uX0ljb25fU21hbGwucG5nJyxcbiAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDEwMCwgMTAwKSxcbiAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMTcsIDM0KSxcbiAgICAgICAgICAgIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDE3LCAyNSlcbiAgICAgICAgfTtcblxuICAgICAgICAgdmFyIGltYWdlVGFyZ2V0ID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovL3d3dy5jbGtlci5jb20vY2xpcGFydHMvVS9QL2ovTS9JL2kveC1tYXJrLXllbGxvdy1tZC5wbmcnLFxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTAwLCAxMDApLFxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgxNywgMzQpLFxuICAgICAgICAgICAgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjUsIDI1KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIG1hcCBjb25maWdcbiAgICAgICAgY29uc29sZS5sb2coJ3dpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgJywgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSApO1xuXG4gICAgICAgIHZhciBpbml0aWFsTWFwQ2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZygzNC4wNSwgLTExOC4yNCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWlzTmFOKHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUpICYmICFpc05hTih3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGluaXRpYWxNYXBDZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUsIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCd3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlICcsIHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGluaXRpYWxNYXBDZW50ZXIpO1xuXG4gICAgICAgIHZhciBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGNlbnRlciAgICAgIDogaW5pdGlhbE1hcENlbnRlcixcbiAgICAgICAgICAgICAgICB6b29tICAgICAgICA6IDE1LFxuICAgICAgICAgICAgICAgIE1hcFR5cGVJZCAgIDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVAsXG4gICAgICAgICAgICAgICAgc2Nyb2xsd2hlZWwgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gZHJhdyBtYXAgd2l0aCBoZWxwZXIgbWFya2Vyc1xuICAgICAgICB2YXIgaGVscGVyTWFya2VycyA9IFtdO1xuICAgICAgICBmdW5jdGlvbiBkcmF3SGVscGVyTWFya2VyKGxvY2F0aW9uKXtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXJrZXI7IG1hcmtlciA9IGhlbHBlck1hcmtlcnNbaV07IGkrKykge1xuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzID0gW107XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGxvY2F0aW9uLCBcbiAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVRhcmdldFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUhlbHBlck1hcmtlcigpe1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1hcmtlcjsgbWFya2VyID0gaGVscGVyTWFya2Vyc1tpXTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhlbHBlck1hcmtlcnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBsb2NhdGlvbiBpbmZvcihsb24sbGF0KVxuICAgICAgICAgICAgc2NvcGUuJGVtaXQoJ2xvYycsIGxvY2F0aW9uKTtcblxuICAgICAgICAgICAgZHJhd0hlbHBlck1hcmtlcihsb2NhdGlvbik7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBwbGFjZSBmb3JtYXR0ZWRfYWRkcmVzcyBhbmQgZHJhdyBpY29uXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKCB7ICdsYXRMbmcnOiBsb2NhdGlvbiB9LCBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAvLyBhcyB1c2VyIGNsaWNrcyBvbiB0aGUgbWFwLFxuICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gc2F2ZSB0aGUgZm9ybWF0dGVkIGFkZHJlc3MgaW4gJHNjb3BlIGFuZFxuICAgICAgICAgICAgICAgIC8vIGl0IHdpbGwgYmUgdXNlZCB0aHJvdWdoIHBvc3RzLmN0cmxcbiAgICAgICAgICAgICAgICAvLyBlbWl0IGJyb2FkY2FzZSAncGxhY2UnIGFuZCBzZW5kIHRoaXMgdG8gYXBwbGljYXRpb24uY3RybFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBmb3JtYXR0ZWRfYWRkcmVzc1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZW1pdCgncGxhY2UnLCByZXN1bHRzWzFdLmZvcm1hdHRlZF9hZGRyZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKFwiXCIsXCJMb2NhdGlvbiBkb2VzIG5vdCBleGlzdHNcIik7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdwbGFjZScsIFwiTG9jYXRpb24gZG9lcyBub3QgZXhpc3RzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGxhY2UgYSBtYXJrZXIgYW5kIGluZm9XaW5kb3dcbiAgICAgICAgdmFyIG1hcmtlcnMgPSBbXTtcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTWFwKCkgeyAgIFxuICAgICAgICAgICAgUG9zdHNTdmMuZmV0Y2goKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xuXG4gICAgICAgICAgICAgICAgLy8gZHJhdyBsYXRlc3QgdXBkYXRlXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gcG9zdHNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIG1hcmtlcnMgcG9zdCBpcyBleGlzaXRpbmcgb25lLCB3ZSBkb24ndCB3YW50IHRvIGRyYXcgaXQgYWdhaW4uXG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgZHJhdyBuZXcgb25lcyFcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1tqXTsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3N0Ll9pZCA9PSBtYXJrZXIucG9zdC5faWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IG51bGw7IC8vIOydtOuvuCDqt7jroKTsp4Qg7Y+s7Iqk7Yq4652866m0LCBudWxs66GcLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyDsnbQgbG9vcOydgCBwb3N0Ll9pZOunjCDqsoDsgqzsmqnsnoTsnLzroZwsIOunjOyVvSDqsrnsuZjrqbQg67CU66GcIGxvb3DsnYQg66mI7Law64+EIOq0nOywruuLpC5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHBvc3TqsIAg7JuQ656YIOyeiOyXh+uNmOqyg+ydtOuptCBwb3N06rCAIG51bGzroZwg7IWLIOuQmOyXiOydhOqyg+ydtOqzoCwgbG9jYXRpb27tlITroZztjbzti7Drj4Qg7J6I64qU7KeAIO2ZleyduO2VmOyekFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc3QgfHwgIXBvc3QuaGFzT3duUHJvcGVydHkoJ2xvY2F0aW9uJykpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ29vZ2xlTG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbi5sYXQsIGxvY2F0aW9uLmxvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIOuwlOyatOuNlOumrCDslYjsl5Ag7J6I64qU7KeA67aA7YSwIOyytO2BrOulvCDtlZjsnqUgXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGdvb2dsZUxvYy5sYXQoKSA8IGN1cnJlbnRfbWFwX253LmxhdCgpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIShnb29nbGVMb2MubGF0KCkgPiBjdXJyZW50X21hcF9zZS5sYXQoKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEoZ29vZ2xlTG9jLmxuZygpIDwgY3VycmVudF9tYXBfc2UubG5nKCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAhKGdvb2dsZUxvYy5sbmcoKSA+IGN1cnJlbnRfbWFwX253LmxuZygpKSApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBza2lwIHRoaXMgcG9zdCAtIG5vIG5lZWQgdG8gZHJhd1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrZXIgb3B0aW9uIHNldHRpbmdcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlck9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZ29vZ2xlTG9jLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJCdWJibGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IGltYWdlUG9zdFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcihtYXJrZXJPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB1cCBzZWxmIHJlbW92ZSBmb3IgbWFya2VyIGl0c2VsZiBhbmQgZnJvbSBtYXJrZXJzIGNvbGxlY3Rpb24gYXQgZnJvbnQtZW5kXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoXG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24ob2xkX21hcmtlciwgb2xkX3Bvc3Qpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRfbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1trXTsgaysrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRfcG9zdC5faWQgPT0gbWFya2VyLnBvc3QuX2lkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcnMuc3BsaWNlKGssIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KG1hcmtlciwgcG9zdCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QubGlmZXNwYW4pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIG1hcmtlciB0byBhcnJheSwgdGhpcyBtZWFucyB0aGF0IGl0IGhhcyBiZWVuIGRyYXduIHRvIG1hcFxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyOiBtYXJrZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCAgOiBwb3N0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vIERSQVdJTkcgTUVTU0FHRSBXSU5ET1cgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGlkPVwiYnViYmxlUG9zdFwiPicgKyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdC5ib2R5ICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj48ZGl2IGlkPVwiYnViYmxlTGlmZUJhclwiPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgICovXG5cblxuICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICAvLyDsiqTsvZTtlITsl5DshJzrtoDthLAg7IOI66Gc7Jq0IOywqOydvOuTnCDsiqTsvZTtlITrpbwg66eM65Ok7Ja0IGVhY2ggZm9yIGxvb3Dsl5DshJwg7IKs7Jqp7ZWc64ukLlxuICAgICAgICAgICAgICAgICAgICAvLyAtLT4g7ZW07JW8LCDqsIEgRE9N7J20IOqwgeqwgeydmCBzY29wZeulvCDqsIDsoLjshJwgcG9zdCBtc2fqsIAg7JWIIOqyuey5nOuLpC5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHNjb3BlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBwYXJlbnQuJG5ldyh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbkluZm9XaW5kb3cgPSAoZnVuY3Rpb24obWFya2VyLCBzY29wZSwgcG9zdG1zZywgcG9zdGxpZmUpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHdpbmRvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvV2luZG93T3B0aW9ucyA9IHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpeGVsT2Zmc2V0OiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgtNDEuNSwgMTAuMCksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyhpbmZvV2luZG93T3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21waWxlIGl0IGJlZm9yZSBsb2FkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICc8ZGl2IG1hcC1tc2c+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcGlsZWQgPSAkY29tcGlsZShjb250ZW50KShzY29wZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvIG1ha2UgZGF0YSBhdmFpbGFibGUgdG8gdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tc2cgPSBwb3N0bXNnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBvc3RsaWZlID0gcG9zdGxpZmU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93LnNldENvbnRlbnQoIGNvbXBpbGVkWzBdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KShtYXJrZXIsIGNoaWxkLCBwb3N0LmJvZHksIHBvc3QubGlmZXNwYW4pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgb3BlbkluZm9XaW5kb3coKTtcbiAgICAgICAgICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBFTkQgb2YgRFJBV0lORyBNRVNTQUdFIFdJTkRPVyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgICAgICAgICB9IC8vIGVuZCBvZiBmb3ItbG9vcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRTZWFyY2hCb3goKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHNlYXJjaCBib3ggYW5kIGxpbmsgaXQgdG8gdGhlIFVJIGVsZW1lbnQuXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhYy1pbnB1dCcpKTsgLy8gQHR5cGUge0hUTUxJbnB1dEVsZW1lbnR9ICBcbiAgICAgICAgICAgIHZhciBjdXJyTG9jQnRuID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tY3VycicpKTsgICAgICBcbiAgICAgICAgICAgIG1hcC5jb250cm9sc1tnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uVE9QX0xFRlRdLnB1c2goaW5wdXQpO1xuICAgICAgICAgICAgbWFwLmNvbnRyb2xzW2dvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfUklHSFRdLnB1c2goY3VyckxvY0J0bik7XG5cbiAgICAgICAgICAgIHZhciBzZWFyY2hCb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLlNlYXJjaEJveCgoaW5wdXQpKTsgLy8gQHR5cGUge0hUTUxJbnB1dEVsZW1lbnR9IFxuXG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIHRoZSBldmVudCBmaXJlZCB3aGVuIHRoZSB1c2VyIHNlbGVjdHMgYW4gaXRlbSBmcm9tIHRoZVxuICAgICAgICAgICAgLy8gcGljayBsaXN0LiBSZXRyaWV2ZSB0aGUgbWF0Y2hpbmcgcGxhY2VzIGZvciB0aGF0IGl0ZW0uXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzZWFyY2hCb3gsICdwbGFjZXNfY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBwbGFjZXMgPSBzZWFyY2hCb3guZ2V0UGxhY2VzKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGxhY2VzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gdGFrZSBvbmx5IDEgc3BvdFxuICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IHBsYWNlc1swXTtcblxuICAgICAgICAgICAgICAgIC8vIHdoZW4gc2VhcmNoIGhhcHBlbnMsIGxvY2F0aW9uIHdpbGwgYmUgdXBkYXRlZCBhcyB3ZWxsIGZvciBwb3N0XG4gICAgICAgICAgICAgICAgLy8gc2NvcGUuJGVtaXQoJ3BsYWNlJywgcGxhY2UuZm9ybWF0dGVkX2FkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubGF0aXR1ZGU7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUgPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sb25naXR1ZGU7XG5cbiAgICAgICAgICAgICAgICBtYXAucGFuVG8ocGxhY2UuZ2VvbWV0cnkubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgIG1hcC5zZXRab29tKDE2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0Q2xpY2tNYXAoKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBjbGljayBldmVudCBvbiBtYXAgdG8gZHJhdyBtYXJrZXJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBkcmF3QW5kU2V0UGxhY2UoZXZlbnQubGF0TG5nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0TW92ZVRvQ3VycmVudExvY2F0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgLy8gbW92aW5nIHRvIGEgcG9zdCdzIGxvY2F0aW9uIGFuZCBkcmF3IGEgbWFya2VyIHRoZXJlXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdoZWFkaW5nX2NoYW5nZWQnLCBmdW5jdGlvbihsb2NhdGlvbikge1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldENlbnRlckNoYW5nZWQoKVxuICAgICAgICB7XG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdjZW50ZXJfY2hhbmdlZCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSA9IG1hcC5nZXRDZW50ZXIoKS5sYXQoKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSA9IG1hcC5nZXRDZW50ZXIoKS5sbmcoKTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZUJvdW5kcygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcERyYWdFbmQoKVxuICAgICAgICB7XG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdkcmFnZW5kJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB1cGRhdGVNYXAoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVCb3VuZHMoKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgYm91bmRzID0gbWFwLmdldEJvdW5kcygpO1xuICAgICAgICAgICAgdmFyIG5lID0gYm91bmRzLmdldE5vcnRoRWFzdCgpOyAvLyBMYXRMbmcgb2YgdGhlIG5vcnRoLWVhc3QgY29ybmVyXG4gICAgICAgICAgICB2YXIgc3cgPSBib3VuZHMuZ2V0U291dGhXZXN0KCk7IC8vIExhdExuZyBvZiB0aGUgc291dGgtd2VzdCBjb3JkZXJcbiAgICAgICAgICAgIC8vWW91IGdldCBub3J0aC13ZXN0IGFuZCBzb3V0aC1lYXN0IGNvcm5lcnMgZnJvbSB0aGUgdHdvIGFib3ZlOlxuXG4gICAgICAgICAgICBjdXJyZW50X21hcF9udyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobmUubGF0KCksIHN3LmxuZygpKTtcbiAgICAgICAgICAgIGN1cnJlbnRfbWFwX3NlID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdy5sYXQoKSwgbmUubG5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBzZXRMb2FkUG9zdE1hcmtlcnMoKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBtYW51YWxseSByZWxvYWQgbWFya2VycyAvIFJFRlJFU0hcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ21hcHR5cGVpZF9jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlSGVscGVyTWFya2VyKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGluaXQgdGhlIG1hcFxuICAgICAgICBmdW5jdGlvbiBpbml0TWFwKCkge1xuICAgICAgICAgICAgaWYgKG1hcCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChlbGVtZW50WzBdLCBtYXBPcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0TG9hZFBvc3RNYXJrZXJzKCk7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCB0byBzZW5kIG1hcCB0byBhcHBsaWNhdGlvbiBjdHJsXG4gICAgICAgICAgICBzY29wZS4kZW1pdCgnbWFwSW5pdCcsIG1hcCk7XG5cbiAgICAgICAgICAgIHNldENsaWNrTWFwKCk7XG5cbiAgICAgICAgICAgIHNldFNlYXJjaEJveCgpO1xuXG4gICAgICAgICAgICBzZXRDZW50ZXJDaGFuZ2VkKCk7XG5cbiAgICAgICAgICAgIHNldE1vdmVUb0N1cnJlbnRMb2NhdGlvbigpO1xuXG4gICAgICAgICAgICBzZXRNYXBEcmFnRW5kKCk7XG5cbiAgICAgICAgICAgIHVwZGF0ZU1hcCgpO1xuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHVwZGF0ZUJvdW5kcygpO1xuICAgICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IFxuICAgICAgICBpbml0TWFwKCk7XG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgaWQ9XCJtYXAtY2FudmFzXCI+PC9kaXY+JyxcbiAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgbGluazogbGlua1xuICAgIH07XG59KTtcblxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uZGlyZWN0aXZlKCdtYXBNc2cnLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGVtcGxhdGVzL3dpbmRvdy5odG1sJyxcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgYXR0cnMpIHsgICAgICAgIFxuICAgICAgICB2YXIgZHVyYXRpb24gPSBzY29wZS5wb3N0bGlmZSArIFwibXNcIjtcblxuICAgICAgICAvLyBhcyB0ZW1wbGF0ZVVybCBET00gaXMgbG9hZGVkLCB0aGlzIGZ1bmN0aW9uIHdpbGwgZ2V0IGNhbGxlZC5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKCdkaXYgZGl2IC5wb3N0bGlmZWJhcicpLmNzcyhcImFuaW1hdGlvbi1kdXJhdGlvblwiLCBkdXJhdGlvbik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJKcXVlcnkgY2FsbGVkIDpcIiArICBkdXJhdGlvbiArIFwiIGFuZCBtc2c6XCIgKyBzY29wZS5tc2cpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgfVxuICAgfVxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHIuY29udHJvbGxlcignUG9zdHNDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgUG9zdHNTdmMsICR3aW5kb3csICRkb2N1bWVudCl7XHJcclx0LyogZW1pdCBicm9hZGNhc3QgZm9yIGN1cnJlbnQgcGFnZUlkICovXHJcdCRzY29wZS4kZW1pdCgncGFnZWNoYW5nZScsICRzY29wZS5wYWdlSWQucG9zdCk7XHJcclx0JHNjb3BlLnBvc3RzID0gW107XHJcci8qIOqwleyVhOyngCBHRVTrlYwg7ZWE7JqU7ZaI7JeH7J2MLlxyXHQkc2NvcGUuJG9uKCdyZWZldGNoJywgZnVuY3Rpb24oXywgb2JqKXtcclx0XHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJcdH0pO1xyKi9cclx0XHJcdC8qIGFzIHNlcnZlciB0ZWxscyB0aGVyZSB3YXMgbmV3IHBvc3QsIGxldHMgcmUtbG9hZCBsaXN0IGRhdGEgKi9cclx0JHNjb3BlLiRvbignd3M6bmV3X3Bvc3QnLCBmdW5jdGlvbihfLCBwb3N0KXtcclx0XHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJcdH0pO1xyXHJcdC8qIG1vdmUgdG8gcG9zdCdzIGxvY2F0aW9uICovXHJcdCRzY29wZS5tb3ZlVG9Mb2MgPSBmdW5jdGlvbihpZCl7XHJcdFx0dmFyIHBvc3QgPSAoJHNjb3BlLnBvc3RzW2lkXSk7XHJcclx0XHR2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xyXHRcdHZhciBnb29nbGVMb2MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxvY2F0aW9uLmxhdCwgbG9jYXRpb24ubG9uKTtcclxyXHRcdCRzY29wZS5tYXAucGFuVG8oZ29vZ2xlTG9jKTtcclx0XHQkc2NvcGUubWFwLnNldFpvb20oMTYpO1xyXHJcdFx0LyogdXNpbmcgYW5ndWxhci1zY3JvbGwgdG8gbW92ZSB0byB0aGUgdG9wIHNtb290aGx5ICovXHJcdFx0dmFyIHRvcCA9IDA7XHIgICAgXHR2YXIgZHVyYXRpb24gPSA0ODA7XHIgICAgXHQkZG9jdW1lbnQuc2Nyb2xsVG9wKHRvcCwgZHVyYXRpb24pLnRoZW4oZnVuY3Rpb24oKSB7XHIgICAgIFx0XHQgY29uc29sZSAmJiBjb25zb2xlLmxvZygnWW91IGp1c3Qgc2Nyb2xsZWQgdG8gdGhlIHRvcCEnKTtcciAgICBcdH0pO1xyXHJcdH07XHJcclx0JHNjb3BlLmFkZFBvc3QgPSBmdW5jdGlvbigpIHtcclx0XHQvKiBnZXQgYXV0b2NvbXBsZXRlZCBwbGFjZSBhbmQgcmVzZXQoc2V0IHRvIHVuZGVmaW5lZCkgKi9cclx0XHR2YXIgcGxhY2UgPSAkc2NvcGUucG9zdHBsYWNlO1xyXHRcdHZhciBsb2NhdGlvbiA9ICRzY29wZS5wb3N0TG9jYXRpb247XHJcclx0XHR2YXIgbG9jYXRpb25KU09OID0gSlNPTi5zdHJpbmdpZnkobG9jYXRpb24pO1xyXHJcdFx0Y29uc29sZS5sb2coXCJQT1NUIGxvY2F0aW9uOlwiLCBsb2NhdGlvbkpTT04pO1xyXHRcdGNvbnNvbGUubG9nKFwiUE9TVCBwbGFjZTpcIiwgcGxhY2UpO1xyXHJcdFx0UG9zdHNTdmMuY3JlYXRlKFxyXHRcdHtcclx0XHRcdGJvZHkgICAgOiAkc2NvcGUuY29udGVudCxcclx0XHRcdGxvY2F0aW9uOiBsb2NhdGlvbkpTT04sXHJcdFx0XHRwbGFjZSAgIDogcGxhY2Vcclx0XHR9KVxyXHRcdC5zdWNjZXNzKGZ1bmN0aW9uKHBvc3Qpe1xyXHRcdFx0LyogbWFudWFsbHkgcmVsb2FkIG1hcmtlcnMgXHJcdFx0XHR1c2luZyBtYXB0eXBlaWQgc2luY2UgaXRzIG1vc3QgbGVhc3QgdXNlZCBldmVudCwgLSBraW5kIG9mIGhhY2t5IHdheSB0byBkbyBpdFxyXHRcdFx0Ki9cclx0XHRcdGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIoJHNjb3BlLm1hcCwgJ21hcHR5cGVpZF9jaGFuZ2VkJyk7XHJcclx0XHRcdCRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QpO1xyXHJcdFx0XHRjb25zb2xlLmxvZyhcInBvc3QgaGFzIGJlZW4gcG9zdHNlZC4gcmVhZHkgZm9yIGRlbGV0ZVwiKTtcclxyXHRcdFx0LyogZnJvbnQgZW5kIHNpZGUgbGlzdCBwb3N0IHJlbW92ZSAqL1xyXHRcdFx0dmFyIGZyb250RW5kUG9zdFJlbW92ZSA9IGZ1bmN0aW9uKCl7IFxyXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5wb3N0cy5sZW5ndGg7ICsraSl7XHJcdFx0XHRcdGlmIChwb3N0Ll9pZCA9PSAkc2NvcGUucG9zdHNbaV0uX2lkKVxyXHRcdFx0XHRcdCRzY29wZS5wb3N0cy5zcGxpY2UoaSwgMSk7XHJcdFx0XHRcdH1cclx0XHRcdH07XHJcdFx0XHRzZXRUaW1lb3V0KGZyb250RW5kUG9zdFJlbW92ZSwgcG9zdC5saWZlc3Bhbik7XHJcclx0XHRcdC8qIHJlc2V0IGlucHV0IGZvcm1zICovXHJcdFx0XHQkc2NvcGUuY29udGVudCAgPSBudWxsO1xyXHRcdH0pXHJcdFx0LmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cyl7XHJcdFx0XHRzd2FsKFwiUG9zdCBmYWlsZWRcIiwgXCJQbGVhc2UgY29tcGxldGUgdGhlIGZyb20gY29ycmVjdGx5XCIsIFwiZXJyb3JcIik7XHJcdFx0fSk7XHJcclx0fTtcclxyXHQvKiBhcyBzZXJ2ZXIgdGVsbHMgdGhlcmUgd2FzIG5ldyBwb3N0LCBsZXRzIHJlLWxvYWQgbGlzdCBkYXRhICovXHJcdCRzY29wZS5yZXF1ZXN0RmV0Y2ggPSBmdW5jdGlvbigpIHtcclx0XHRQb3N0c1N2Yy5mZXRjaCgpXHJcdFx0LnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xyXHRcdFx0Y29uc29sZS5sb2coJ1Bvc3RzIGhhdmUgYmVlbiBsb2FkZWQgc3VjY2Vzc2Z1bGx5IGZvciBmcm9udCBwYWdlJyk7XHJcdFx0XHQkc2NvcGUucG9zdHMgPSBwb3N0cztcclx0XHR9KTtcclx0fTtcclxyXHQkc2NvcGUucmVxdWVzdEZldGNoKCk7XHJ9KTtcciIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgZnVuY3Rpb24oJGh0dHApe1xuXHR0aGlzLmZldGNoID0gZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJyk7XG5cdH07XG5cblx0dGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KXtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuXHR9O1xuXG5cdHRoaXMucmVtb3ZlID0gZnVuY3Rpb24ocG9zdCl7XG5cdFx0Y29uc29sZS5sb2coXCJkZWxldGluZyBwb3N0aW5nXCIpO1xuXHRcdGNvbnNvbGUubG9nKCdwb3N0Ll9pZDonLCBwb3N0Ll9pZCk7XG5cdFx0cmV0dXJuICRodHRwLnB1dCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuXHR9O1xufSk7IiwiXG5hbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuXHQnbmdSb3V0ZScsXG5cdCdkdVNjcm9sbCdcbl0pO1xuXG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJHdpbmRvdywgJGh0dHApe1xuXHQkc2NvcGUucGFnZUlkID0geyBcblx0XHRwb3N0IDogMCxcblx0fTtcblxuXHQkc2NvcGUubmF2Q29sbGFwc2VkID0gdHJ1ZTtcblx0JHNjb3BlLmNvbGxhcHNlID0gZnVuY3Rpb24oKXtcblx0XHQkc2NvcGUubmF2Q29sbGFwc2VkID0gdHJ1ZTtcblx0fTtcblxuXHQvKlxuXHQvLyDqsJXslYTsp4Ag6rKf7Jy866GcIOuntSDsl4XrjbDsnbTtirjrpbwg7ZWY64qUIOuwqeyLnS5cblx0JHNjb3BlLnJlcXVlc3RSZWZyZXNoID0gZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3JlZnJlc2gnKVxuXHRcdC50aGVuKFxuXHRcdGZ1bmN0aW9uKHJlcyl7XG5cdFx0XHRjb25zb2xlLmxvZyhcIk9LQVksIHNlcnZlciBzYXlzIHdlIHVwZGF0ZSB0aGUgbWFwIVwiKTtcblxuXHRcdFx0JHNjb3BlLiRlbWl0KCdyZWZldGNoJywge30pOyAvLyB0byB1cGRhdGUgbGlzdFxuXHRcdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnKTsgLy8gdG8gdXBkYXRlIG1hcFxuXG5cdFx0XHQkc2NvcGUucmVxdWVzdFJlZnJlc2goKTtcblx0XHR9LFxuXHRcdGZ1bmN0aW9uKGVycil7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkVycm9yIHNob3VsZCBub3QgaGFwcGVuIGZvciB0aGlzLi46XCIsIGVycik7XG5cdFx0fSk7XG5cdH1cblx0JHNjb3BlLnJlcXVlc3RSZWZyZXNoKCk7XG5cdCovXG5cblx0Ly8gYXMgc2VydmVyIHNvY2tldCBzZW5kICd3czpuZXdfcG9zdCcgLCB3ZSBjYW4gdXBkYXRlIHRoZSBtYXAhXG5cdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCl7XG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnbWFwdHlwZWlkX2NoYW5nZWQnKTtcblx0fSk7XG5cblx0LyogbW92ZSB0byBjdXJyZW50IGxvY2F0aW9uICovXG5cdCRzY29wZS5tb3ZlVG9DdXJyZW50TG9jYXRpb24gPSBmdW5jdGlvbigpe1xuXHRcdGZ1bmN0aW9uIGdldEN1cnJMb2NTdWNjZXNzKHBvcykge1xuICAgICAgICAgICAgLyogbWFrZSBzdXJlIHRvIGNoZWNrIHdlIGFyZSBvbiBwb3N0IHBhZ2Ugd2l0aCBtYXAgZmlyc3QgKi9cbiAgICAgICAgICAgIGlmICgkc2NvcGUuY3VycmVudFBhZ2VJZCAhPSAkc2NvcGUucGFnZUlkLnBvc3QpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICB2YXIgY3JkID0gcG9zLmNvb3JkcztcblxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSA9IGNyZC5sYXRpdHVkZTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlID0gY3JkLmxvbmdpdHVkZTtcblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTGF0aXR1ZGUgOiAnICsgY3JkLmxhdGl0dWRlKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0xvbmdpdHVkZTogJyArIGNyZC5sb25naXR1ZGUpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnTW9yZSBvciBsZXNzICcgKyBjcmQuYWNjdXJhY3kgKyAnIG1ldGVycy4nKTtcbiAgICAgICAgICAgIHZhciBnb29nbGVMb2MgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGNyZC5sYXRpdHVkZSwgY3JkLmxvbmdpdHVkZSk7XG5cbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIoJHNjb3BlLm1hcCwgJ2hlYWRpbmdfY2hhbmdlZCcsIGdvb2dsZUxvYyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5tYXAucGFuVG8oZ29vZ2xlTG9jKVxuICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRab29tKDE1KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEN1cnJMb2NFcnJvcihlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRVJST1IoJyArIGVyci5jb2RlICsgJyk6ICcgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKiBpbml0IG1hcCBhbmQgcGxhY2Ugc29tZSBtYXJrZXJzLCBzbyBldmVyeXRoaW5nIHN0YXJ0IHdpdGggdGhpcyBmdW5jdGlvbi4gKi9cbiAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihnZXRDdXJyTG9jU3VjY2VzcywgZ2V0Q3VyckxvY0Vycm9yKTtcblxuICAgICAgICBzd2FsKHsgICB0aXRsZTogXCJcIiwgICB0ZXh0OiBcIk1vdmluZyB0byBjdXJyZW50IGxvY2F0aW9uLi5cIiwgICB0aW1lcjogMTUwMCwgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7XG5cdH07XG5cblx0JHNjb3BlLiRvbigncGFnZWNoYW5nZScsIGZ1bmN0aW9uKF8sIHBhZ2VJZCl7XG5cdFx0JHNjb3BlLmN1cnJlbnRQYWdlSWQgPSBwYWdlSWQ7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ2xvYycsIGZ1bmN0aW9uKF8sIGxvY2F0aW9uKXtcblx0XHRjb25zb2xlLmxvZygnSU46Jyxsb2NhdGlvbik7XG5cdFx0dmFyIGxhdCA9IGxvY2F0aW9uLmxhdCgpO1xuXHRcdHZhciBsb24gPSBsb2NhdGlvbi5sbmcoKTtcblx0XHQkc2NvcGUucG9zdExvY2F0aW9uID0ge1xuXHRcdFx0bGF0OiBsYXQsXG5cdFx0XHRsb246IGxvblxuXHRcdH07XG5cdFx0Y29uc29sZS5sb2coJ1NBVkVEOicsICRzY29wZS5wb3N0TG9jYXRpb24pO1xuXHR9KTtcblxuXHQkc2NvcGUuJG9uKCdwbGFjZScsIGZ1bmN0aW9uKF8sIHBsYWNlKXtcblx0XHQvLyBGb3JjaW5nIHRoZSB1cGRhdGUgd2l0aCAkYXBwbHkoKSBtZXRob2Qgb24gJHNjb3BlXG5cdFx0Ly8gcHJvYmxlbSByZWxhdGVkIG5vdGU6IGh0dHA6Ly93d3cuamVmZnJ5aG91c2VyLmNvbS9pbmRleC5jZm0vMjAxNC82LzIvSG93LWRvLUktcnVuLWNvZGUtd2hlbi1hLXZhcmlhYmxlLWNoYW5nZXMtd2l0aC1Bbmd1bGFySlNcblx0XHQkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdCRzY29wZS5wb3N0cGxhY2UgPSBwbGFjZTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ1NBVkVEOicsICRzY29wZS5wb3N0cGxhY2UpO1xuXHRcdFx0fVxuXHRcdCk7XG5cdH0pO1xuXG5cdCRzY29wZS4kb24oJ21hcEluaXQnLCBmdW5jdGlvbihfLCBtYXApe1xuXHRcdCRzY29wZS5tYXAgPSBtYXA7XG5cdFx0XG5cdFx0Ly8gdXBkYXRlIG1hcCBib3VuZHMgYXMgYXBwIGxhdW5jaGVzXG5cdFx0Z29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcigkc2NvcGUubWFwLCAnY2VudGVyX2NoYW5nZWQnKTtcblx0fSk7XG5cbn0pO1xuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcil7XG5cdCRyb3V0ZVByb3ZpZGVyXG5cdC53aGVuKCcvJywgXG5cdFx0e1xuXHRcdFx0Y29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIFxuXHRcdFx0dGVtcGxhdGVVcmw6ICcvdGVtcGxhdGVzL3Bvc3RzLmh0bWwnXG5cdFx0fSlcblx0Ly8gUmVkaXJlY3QgdG8gdGhlIHJvb3QgcGFnZS5cblx0Lm90aGVyd2lzZShcblx0XHR7XG4gICBcdFx0XHRyZWRpcmVjdFRvOiAnLydcblx0XHR9KTtcbn0pO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5zZXJ2aWNlKCdVdGlsU3ZjJywgZnVuY3Rpb24oKXtcblx0dmFyIHN2YyA9IHRoaXM7XG5cblx0c3ZjLmRlZzJyYWQgPSBmdW5jdGlvbihkZWcpIHtcblx0ICByZXR1cm4gZGVnICogKE1hdGguUEkvMTgwKTtcblx0fTtcblxuXHRzdmMuZ2V0RGlzdGFuY2VGcm9tTGF0TG9uSW5LbSA9IGZ1bmN0aW9uIChsYXQxLGxvbjEsbGF0Mixsb24yKSB7XG5cdCAgdmFyIFIgPSA2MzcxO1xuXHQgIHZhciBkTGF0ID0gc3ZjLmRlZzJyYWQobGF0Mi1sYXQxKTtcblx0ICB2YXIgZExvbiA9IHN2Yy5kZWcycmFkKGxvbjItbG9uMSk7IFxuXHQgIHZhciBhID0gXG5cdCAgICBNYXRoLnNpbihkTGF0LzIpICogTWF0aC5zaW4oZExhdC8yKSArXG5cdCAgICBNYXRoLmNvcyhzdmMuZGVnMnJhZChsYXQxKSkgKiBNYXRoLmNvcyhzdmMuZGVnMnJhZChsYXQyKSkgKiBcblx0ICAgIE1hdGguc2luKGRMb24vMikgKiBNYXRoLnNpbihkTG9uLzIpXG5cdCAgICA7IFxuXHQgIHZhciBjID0gMiAqIE1hdGguYXRhbjIoTWF0aC5zcXJ0KGEpLCBNYXRoLnNxcnQoMS1hKSk7IFxuXHQgIHZhciBkID0gUiAqIGM7XG5cdCAgcmV0dXJuIGQ7XG5cdH07XG59KTtcblxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uZGlyZWN0aXZlKCdhcHBNYXAnLCBmdW5jdGlvbihQb3N0c1N2YywgVXRpbFN2YywgJGNvbXBpbGUsICR0aW1lb3V0KSB7XG4gICAgLy8gZGlyZWN0aXZlIGxpbmsgZnVuY3Rpb25cbiAgICB2YXIgbGluayA9IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICB2YXIgbWFwO1xuICAgICAgICB2YXIgY3VycmVudF9tYXBfbnc7XG4gICAgICAgIHZhciBjdXJyZW50X21hcF9zZTtcbiAgICAgICAgXG4gICAgICAgIHZhciBpbWFnZVBvc3QgPSB7XG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2NhdGNobWUuaWZ5b3VjYW4uY29tL2ltYWdlcy9waWN0dXJlcy9JWUNfSWNvbnMvSVlDX0xvY2F0aW9uX0ljb25fU21hbGwucG5nJyxcbiAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDEwMCwgMTAwKSxcbiAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMTcsIDM0KSxcbiAgICAgICAgICAgIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDE3LCAyNSlcbiAgICAgICAgfTtcblxuICAgICAgICAgdmFyIGltYWdlVGFyZ2V0ID0ge1xuICAgICAgICAgICAgdXJsOiAnaHR0cDovL3d3dy5jbGtlci5jb20vY2xpcGFydHMvVS9QL2ovTS9JL2kveC1tYXJrLXllbGxvdy1tZC5wbmcnLFxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTAwLCAxMDApLFxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgxNywgMzQpLFxuICAgICAgICAgICAgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjUsIDI1KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIG1hcCBjb25maWdcbiAgICAgICAgY29uc29sZS5sb2coJ3dpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgJywgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSApO1xuXG4gICAgICAgIHZhciBpbml0aWFsTWFwQ2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZygzNC4wNSwgLTExOC4yNCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWlzTmFOKHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUpICYmICFpc05hTih3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGluaXRpYWxNYXBDZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUsIHdpbmRvdy5sb2NhbFN0b3JhZ2UubG9uZ2l0dWRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCd3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlICcsIHdpbmRvdy5sb2NhbFN0b3JhZ2UubGF0aXR1ZGUgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGluaXRpYWxNYXBDZW50ZXIpO1xuXG4gICAgICAgIHZhciBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGNlbnRlciAgICAgIDogaW5pdGlhbE1hcENlbnRlcixcbiAgICAgICAgICAgICAgICB6b29tICAgICAgICA6IDE1LFxuICAgICAgICAgICAgICAgIE1hcFR5cGVJZCAgIDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVAsXG4gICAgICAgICAgICAgICAgc2Nyb2xsd2hlZWwgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gZHJhdyBtYXAgd2l0aCBoZWxwZXIgbWFya2Vyc1xuICAgICAgICB2YXIgaGVscGVyTWFya2VycyA9IFtdO1xuICAgICAgICBmdW5jdGlvbiBkcmF3SGVscGVyTWFya2VyKGxvY2F0aW9uKXtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXJrZXI7IG1hcmtlciA9IGhlbHBlck1hcmtlcnNbaV07IGkrKykge1xuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzID0gW107XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGxvY2F0aW9uLCBcbiAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVRhcmdldFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBoZWxwZXJNYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUhlbHBlck1hcmtlcigpe1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1hcmtlcjsgbWFya2VyID0gaGVscGVyTWFya2Vyc1tpXTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhlbHBlck1hcmtlcnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBsb2NhdGlvbiBpbmZvcihsb24sbGF0KVxuICAgICAgICAgICAgc2NvcGUuJGVtaXQoJ2xvYycsIGxvY2F0aW9uKTtcblxuICAgICAgICAgICAgZHJhd0hlbHBlck1hcmtlcihsb2NhdGlvbik7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBwbGFjZSBmb3JtYXR0ZWRfYWRkcmVzcyBhbmQgZHJhdyBpY29uXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKCB7ICdsYXRMbmcnOiBsb2NhdGlvbiB9LCBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAvLyBhcyB1c2VyIGNsaWNrcyBvbiB0aGUgbWFwLFxuICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gc2F2ZSB0aGUgZm9ybWF0dGVkIGFkZHJlc3MgaW4gJHNjb3BlIGFuZFxuICAgICAgICAgICAgICAgIC8vIGl0IHdpbGwgYmUgdXNlZCB0aHJvdWdoIHBvc3RzLmN0cmxcbiAgICAgICAgICAgICAgICAvLyBlbWl0IGJyb2FkY2FzZSAncGxhY2UnIGFuZCBzZW5kIHRoaXMgdG8gYXBwbGljYXRpb24uY3RybFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBmb3JtYXR0ZWRfYWRkcmVzc1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZW1pdCgncGxhY2UnLCByZXN1bHRzWzFdLmZvcm1hdHRlZF9hZGRyZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKFwiXCIsXCJMb2NhdGlvbiBkb2VzIG5vdCBleGlzdHNcIik7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRlbWl0KCdwbGFjZScsIFwiTG9jYXRpb24gZG9lcyBub3QgZXhpc3RzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGxhY2UgYSBtYXJrZXIgYW5kIGluZm9XaW5kb3dcbiAgICAgICAgdmFyIG1hcmtlcnMgPSBbXTtcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTWFwKCkgeyAgIFxuICAgICAgICAgICAgUG9zdHNTdmMuZmV0Y2goKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24ocG9zdHMpe1xuXG4gICAgICAgICAgICAgICAgLy8gZHJhdyBsYXRlc3QgdXBkYXRlXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3N0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3N0ID0gcG9zdHNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIG1hcmtlcnMgcG9zdCBpcyBleGlzaXRpbmcgb25lLCB3ZSBkb24ndCB3YW50IHRvIGRyYXcgaXQgYWdhaW4uXG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgZHJhdyBuZXcgb25lcyFcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1tqXTsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3N0Ll9pZCA9PSBtYXJrZXIucG9zdC5faWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IG51bGw7IC8vIOydtOuvuCDqt7jroKTsp4Qg7Y+s7Iqk7Yq4652866m0LCBudWxs66GcLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyDsnbQgbG9vcOydgCBwb3N0Ll9pZOunjCDqsoDsgqzsmqnsnoTsnLzroZwsIOunjOyVvSDqsrnsuZjrqbQg67CU66GcIGxvb3DsnYQg66mI7Law64+EIOq0nOywruuLpC5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHBvc3TqsIAg7JuQ656YIOyeiOyXh+uNmOqyg+ydtOuptCBwb3N06rCAIG51bGzroZwg7IWLIOuQmOyXiOydhOqyg+ydtOqzoCwgbG9jYXRpb27tlITroZztjbzti7Drj4Qg7J6I64qU7KeAIO2ZleyduO2VmOyekFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc3QgfHwgIXBvc3QuaGFzT3duUHJvcGVydHkoJ2xvY2F0aW9uJykpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gc2tpcCB0aGlzIHBvc3QgLSBubyBuZWVkIHRvIGRyYXdcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBhbmd1bGFyLmZyb21Kc29uKHBvc3QubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ29vZ2xlTG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbi5sYXQsIGxvY2F0aW9uLmxvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIOuwlOyatOuNlOumrCDslYjsl5Ag7J6I64qU7KeA67aA7YSwIOyytO2BrOulvCDtlZjsnqUgXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGdvb2dsZUxvYy5sYXQoKSA8IGN1cnJlbnRfbWFwX253LmxhdCgpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgIShnb29nbGVMb2MubGF0KCkgPiBjdXJyZW50X21hcF9zZS5sYXQoKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICEoZ29vZ2xlTG9jLmxuZygpIDwgY3VycmVudF9tYXBfc2UubG5nKCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAhKGdvb2dsZUxvYy5sbmcoKSA+IGN1cnJlbnRfbWFwX253LmxuZygpKSApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBza2lwIHRoaXMgcG9zdCAtIG5vIG5lZWQgdG8gZHJhd1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrZXIgb3B0aW9uIHNldHRpbmdcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlck9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZ29vZ2xlTG9jLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJCdWJibGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IGltYWdlUG9zdFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcihtYXJrZXJPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB1cCBzZWxmIHJlbW92ZSBmb3IgbWFya2VyIGl0c2VsZiBhbmQgZnJvbSBtYXJrZXJzIGNvbGxlY3Rpb24gYXQgZnJvbnQtZW5kXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoXG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24ob2xkX21hcmtlciwgb2xkX3Bvc3Qpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRfbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDAsIG1hcmtlcjsgbWFya2VyID0gbWFya2Vyc1trXTsgaysrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRfcG9zdC5faWQgPT0gbWFya2VyLnBvc3QuX2lkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcnMuc3BsaWNlKGssIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KG1hcmtlciwgcG9zdCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QubGlmZXNwYW4pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIG1hcmtlciB0byBhcnJheSwgdGhpcyBtZWFucyB0aGF0IGl0IGhhcyBiZWVuIGRyYXduIHRvIG1hcFxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyOiBtYXJrZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCAgOiBwb3N0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vIERSQVdJTkcgTUVTU0FHRSBXSU5ET1cgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGlkPVwiYnViYmxlUG9zdFwiPicgKyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdC5ib2R5ICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj48ZGl2IGlkPVwiYnViYmxlTGlmZUJhclwiPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgICovXG5cblxuICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICAvLyDsiqTsvZTtlITsl5DshJzrtoDthLAg7IOI66Gc7Jq0IOywqOydvOuTnCDsiqTsvZTtlITrpbwg66eM65Ok7Ja0IGVhY2ggZm9yIGxvb3Dsl5DshJwg7IKs7Jqp7ZWc64ukLlxuICAgICAgICAgICAgICAgICAgICAvLyAtLT4g7ZW07JW8LCDqsIEgRE9N7J20IOqwgeqwgeydmCBzY29wZeulvCDqsIDsoLjshJwgcG9zdCBtc2fqsIAg7JWIIOqyuey5nOuLpC5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHNjb3BlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBwYXJlbnQuJG5ldyh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbkluZm9XaW5kb3cgPSAoZnVuY3Rpb24obWFya2VyLCBzY29wZSwgcG9zdG1zZywgcG9zdGxpZmUpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHdpbmRvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvV2luZG93T3B0aW9ucyA9IHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpeGVsT2Zmc2V0OiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgtNDEuNSwgMTAuMCksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyhpbmZvV2luZG93T3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21waWxlIGl0IGJlZm9yZSBsb2FkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICc8ZGl2IG1hcC1tc2c+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcGlsZWQgPSAkY29tcGlsZShjb250ZW50KShzY29wZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvIG1ha2UgZGF0YSBhdmFpbGFibGUgdG8gdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tc2cgPSBwb3N0bXNnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBvc3RsaWZlID0gcG9zdGxpZmU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93LnNldENvbnRlbnQoIGNvbXBpbGVkWzBdICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KShtYXJrZXIsIGNoaWxkLCBwb3N0LmJvZHksIHBvc3QubGlmZXNwYW4pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgb3BlbkluZm9XaW5kb3coKTtcbiAgICAgICAgICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBFTkQgb2YgRFJBV0lORyBNRVNTQUdFIFdJTkRPVyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgICAgICAgICB9IC8vIGVuZCBvZiBmb3ItbG9vcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRTZWFyY2hCb3goKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHNlYXJjaCBib3ggYW5kIGxpbmsgaXQgdG8gdGhlIFVJIGVsZW1lbnQuXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhYy1pbnB1dCcpKTsgLy8gQHR5cGUge0hUTUxJbnB1dEVsZW1lbnR9ICBcbiAgICAgICAgICAgIHZhciBjdXJyTG9jQnRuID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tY3VycicpKTsgICAgICBcbiAgICAgICAgICAgIG1hcC5jb250cm9sc1tnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uVE9QX0xFRlRdLnB1c2goaW5wdXQpO1xuICAgICAgICAgICAgbWFwLmNvbnRyb2xzW2dvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfUklHSFRdLnB1c2goY3VyckxvY0J0bik7XG5cbiAgICAgICAgICAgIHZhciBzZWFyY2hCb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLlNlYXJjaEJveCgoaW5wdXQpKTsgLy8gQHR5cGUge0hUTUxJbnB1dEVsZW1lbnR9IFxuXG4gICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIHRoZSBldmVudCBmaXJlZCB3aGVuIHRoZSB1c2VyIHNlbGVjdHMgYW4gaXRlbSBmcm9tIHRoZVxuICAgICAgICAgICAgLy8gcGljayBsaXN0LiBSZXRyaWV2ZSB0aGUgbWF0Y2hpbmcgcGxhY2VzIGZvciB0aGF0IGl0ZW0uXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzZWFyY2hCb3gsICdwbGFjZXNfY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBwbGFjZXMgPSBzZWFyY2hCb3guZ2V0UGxhY2VzKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGxhY2VzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gdGFrZSBvbmx5IDEgc3BvdFxuICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IHBsYWNlc1swXTtcblxuICAgICAgICAgICAgICAgIC8vIHdoZW4gc2VhcmNoIGhhcHBlbnMsIGxvY2F0aW9uIHdpbGwgYmUgdXBkYXRlZCBhcyB3ZWxsIGZvciBwb3N0XG4gICAgICAgICAgICAgICAgLy8gc2NvcGUuJGVtaXQoJ3BsYWNlJywgcGxhY2UuZm9ybWF0dGVkX2FkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxhdGl0dWRlID0gcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubGF0aXR1ZGU7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sb25naXR1ZGUgPSBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sb25naXR1ZGU7XG5cbiAgICAgICAgICAgICAgICBtYXAucGFuVG8ocGxhY2UuZ2VvbWV0cnkubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgIG1hcC5zZXRab29tKDE2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0Q2xpY2tNYXAoKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBjbGljayBldmVudCBvbiBtYXAgdG8gZHJhdyBtYXJrZXJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBkcmF3QW5kU2V0UGxhY2UoZXZlbnQubGF0TG5nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0TW92ZVRvQ3VycmVudExvY2F0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgLy8gbW92aW5nIHRvIGEgcG9zdCdzIGxvY2F0aW9uIGFuZCBkcmF3IGEgbWFya2VyIHRoZXJlXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdoZWFkaW5nX2NoYW5nZWQnLCBmdW5jdGlvbihsb2NhdGlvbikge1xuICAgICAgICAgICAgICAgIGRyYXdBbmRTZXRQbGFjZShsb2NhdGlvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldENlbnRlckNoYW5nZWQoKVxuICAgICAgICB7XG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdjZW50ZXJfY2hhbmdlZCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5sYXRpdHVkZSA9IG1hcC5nZXRDZW50ZXIoKS5sYXQoKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmxvbmdpdHVkZSA9IG1hcC5nZXRDZW50ZXIoKS5sbmcoKTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZUJvdW5kcygpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcERyYWdFbmQoKVxuICAgICAgICB7XG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdkcmFnZW5kJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB1cGRhdGVNYXAoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVCb3VuZHMoKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgYm91bmRzID0gbWFwLmdldEJvdW5kcygpO1xuICAgICAgICAgICAgdmFyIG5lID0gYm91bmRzLmdldE5vcnRoRWFzdCgpOyAvLyBMYXRMbmcgb2YgdGhlIG5vcnRoLWVhc3QgY29ybmVyXG4gICAgICAgICAgICB2YXIgc3cgPSBib3VuZHMuZ2V0U291dGhXZXN0KCk7IC8vIExhdExuZyBvZiB0aGUgc291dGgtd2VzdCBjb3JkZXJcbiAgICAgICAgICAgIC8vWW91IGdldCBub3J0aC13ZXN0IGFuZCBzb3V0aC1lYXN0IGNvcm5lcnMgZnJvbSB0aGUgdHdvIGFib3ZlOlxuXG4gICAgICAgICAgICBjdXJyZW50X21hcF9udyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobmUubGF0KCksIHN3LmxuZygpKTtcbiAgICAgICAgICAgIGN1cnJlbnRfbWFwX3NlID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdy5sYXQoKSwgbmUubG5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBzZXRMb2FkUG9zdE1hcmtlcnMoKVxuICAgICAgICB7XG4gICAgICAgICAgICAvLyBtYW51YWxseSByZWxvYWQgbWFya2VycyAvIFJFRlJFU0hcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ21hcHR5cGVpZF9jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlSGVscGVyTWFya2VyKCk7XG4gICAgICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGluaXQgdGhlIG1hcFxuICAgICAgICBmdW5jdGlvbiBpbml0TWFwKCkge1xuICAgICAgICAgICAgaWYgKG1hcCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChlbGVtZW50WzBdLCBtYXBPcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0TG9hZFBvc3RNYXJrZXJzKCk7XG5cbiAgICAgICAgICAgIC8vIGJyb2FkY2FzdCB0byBzZW5kIG1hcCB0byBhcHBsaWNhdGlvbiBjdHJsXG4gICAgICAgICAgICBzY29wZS4kZW1pdCgnbWFwSW5pdCcsIG1hcCk7XG5cbiAgICAgICAgICAgIHNldENsaWNrTWFwKCk7XG5cbiAgICAgICAgICAgIHNldFNlYXJjaEJveCgpO1xuXG4gICAgICAgICAgICBzZXRDZW50ZXJDaGFuZ2VkKCk7XG5cbiAgICAgICAgICAgIHNldE1vdmVUb0N1cnJlbnRMb2NhdGlvbigpO1xuXG4gICAgICAgICAgICBzZXRNYXBEcmFnRW5kKCk7XG5cbiAgICAgICAgICAgIHVwZGF0ZU1hcCgpO1xuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHVwZGF0ZUJvdW5kcygpO1xuICAgICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9IFxuICAgICAgICBpbml0TWFwKCk7XG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgaWQ9XCJtYXAtY2FudmFzXCI+PC9kaXY+JyxcbiAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgbGluazogbGlua1xuICAgIH07XG59KTtcblxuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5kaXJlY3RpdmUoJ21hcE1zZycsIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi90ZW1wbGF0ZXMvd2luZG93Lmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBhdHRycykgeyAgICAgICAgXG4gICAgICAgIHZhciBkdXJhdGlvbiA9IHNjb3BlLnBvc3RsaWZlICsgXCJtc1wiO1xuXG4gICAgICAgIC8vIGFzIHRlbXBsYXRlVXJsIERPTSBpcyBsb2FkZWQsIHRoaXMgZnVuY3Rpb24gd2lsbCBnZXQgY2FsbGVkLlxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICQoJ2RpdiBkaXYgLnBvc3RsaWZlYmFyJykuY3NzKFwiYW5pbWF0aW9uLWR1cmF0aW9uXCIsIGR1cmF0aW9uKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkpxdWVyeSBjYWxsZWQgOlwiICsgIGR1cmF0aW9uICsgXCIgYW5kIG1zZzpcIiArIHNjb3BlLm1zZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICB9XG4gICB9XG59KTtcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyLmNvbnRyb2xsZXIoJ1Bvc3RzQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIFBvc3RzU3ZjLCAkd2luZG93LCAkZG9jdW1lbnQpe1xyXHJcdC8qIGVtaXQgYnJvYWRjYXN0IGZvciBjdXJyZW50IHBhZ2VJZCAqL1xyXHQkc2NvcGUuJGVtaXQoJ3BhZ2VjaGFuZ2UnLCAkc2NvcGUucGFnZUlkLnBvc3QpO1xyXHJcdCRzY29wZS5wb3N0cyA9IFtdO1xyXHIvKiDqsJXslYTsp4AgR0VU65WMIO2VhOyalO2WiOyXh+ydjC5cclx0JHNjb3BlLiRvbigncmVmZXRjaCcsIGZ1bmN0aW9uKF8sIG9iail7XHJcdFx0JHNjb3BlLnJlcXVlc3RGZXRjaCgpO1xyXHR9KTtcciovXHJcdFxyXHQvKiBhcyBzZXJ2ZXIgdGVsbHMgdGhlcmUgd2FzIG5ldyBwb3N0LCBsZXRzIHJlLWxvYWQgbGlzdCBkYXRhICovXHJcdCRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCl7XHJcdFx0JHNjb3BlLnJlcXVlc3RGZXRjaCgpO1xyXHR9KTtcclxyXHQvKiBtb3ZlIHRvIHBvc3QncyBsb2NhdGlvbiAqL1xyXHQkc2NvcGUubW92ZVRvTG9jID0gZnVuY3Rpb24oaWQpe1xyXHRcdHZhciBwb3N0ID0gKCRzY29wZS5wb3N0c1tpZF0pO1xyXHJcdFx0dmFyIGxvY2F0aW9uID0gYW5ndWxhci5mcm9tSnNvbihwb3N0LmxvY2F0aW9uKTtcclx0XHR2YXIgZ29vZ2xlTG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbi5sYXQsIGxvY2F0aW9uLmxvbik7XHJcclx0XHQkc2NvcGUubWFwLnBhblRvKGdvb2dsZUxvYyk7XHJcdFx0JHNjb3BlLm1hcC5zZXRab29tKDE2KTtcclxyXHRcdC8qIHVzaW5nIGFuZ3VsYXItc2Nyb2xsIHRvIG1vdmUgdG8gdGhlIHRvcCBzbW9vdGhseSAqL1xyXHRcdHZhciB0b3AgPSAwO1xyICAgIFx0dmFyIGR1cmF0aW9uID0gNDgwO1xyICAgIFx0JGRvY3VtZW50LnNjcm9sbFRvcCh0b3AsIGR1cmF0aW9uKS50aGVuKGZ1bmN0aW9uKCkge1xyICAgICBcdFx0IGNvbnNvbGUgJiYgY29uc29sZS5sb2coJ1lvdSBqdXN0IHNjcm9sbGVkIHRvIHRoZSB0b3AhJyk7XHIgICAgXHR9KTtcclxyXHR9O1xyXHJcdCRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24oKSB7XHJcdFx0LyogZ2V0IGF1dG9jb21wbGV0ZWQgcGxhY2UgYW5kIHJlc2V0KHNldCB0byB1bmRlZmluZWQpICovXHJcdFx0dmFyIHBsYWNlID0gJHNjb3BlLnBvc3RwbGFjZTtcclx0XHR2YXIgbG9jYXRpb24gPSAkc2NvcGUucG9zdExvY2F0aW9uO1xyXHJcdFx0dmFyIGxvY2F0aW9uSlNPTiA9IEpTT04uc3RyaW5naWZ5KGxvY2F0aW9uKTtcclxyXHRcdGNvbnNvbGUubG9nKFwiUE9TVCBsb2NhdGlvbjpcIiwgbG9jYXRpb25KU09OKTtcclx0XHRjb25zb2xlLmxvZyhcIlBPU1QgcGxhY2U6XCIsIHBsYWNlKTtcclxyXHRcdFBvc3RzU3ZjLmNyZWF0ZShcclx0XHR7XHJcdFx0XHRib2R5ICAgIDogJHNjb3BlLmNvbnRlbnQsXHJcdFx0XHRsb2NhdGlvbjogbG9jYXRpb25KU09OLFxyXHRcdFx0cGxhY2UgICA6IHBsYWNlXHJcdFx0fSlcclx0XHQuc3VjY2VzcyhmdW5jdGlvbihwb3N0KXtcclx0XHRcdC8qIG1hbnVhbGx5IHJlbG9hZCBtYXJrZXJzIFxyXHRcdFx0dXNpbmcgbWFwdHlwZWlkIHNpbmNlIGl0cyBtb3N0IGxlYXN0IHVzZWQgZXZlbnQsIC0ga2luZCBvZiBoYWNreSB3YXkgdG8gZG8gaXRcclx0XHRcdCovXHJcdFx0XHRnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXAsICdtYXB0eXBlaWRfY2hhbmdlZCcpO1xyXHJcdFx0XHQkc2NvcGUucG9zdHMudW5zaGlmdChwb3N0KTtcclxyXHRcdFx0Y29uc29sZS5sb2coXCJwb3N0IGhhcyBiZWVuIHBvc3RzZWQuIHJlYWR5IGZvciBkZWxldGVcIik7XHJcclx0XHRcdC8qIGZyb250IGVuZCBzaWRlIGxpc3QgcG9zdCByZW1vdmUgKi9cclx0XHRcdHZhciBmcm9udEVuZFBvc3RSZW1vdmUgPSBmdW5jdGlvbigpeyBcclx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucG9zdHMubGVuZ3RoOyArK2kpe1xyXHRcdFx0XHRpZiAocG9zdC5faWQgPT0gJHNjb3BlLnBvc3RzW2ldLl9pZClcclx0XHRcdFx0XHQkc2NvcGUucG9zdHMuc3BsaWNlKGksIDEpO1xyXHRcdFx0XHR9XHJcdFx0XHR9O1xyXHRcdFx0c2V0VGltZW91dChmcm9udEVuZFBvc3RSZW1vdmUsIHBvc3QubGlmZXNwYW4pO1xyXHJcdFx0XHQvKiByZXNldCBpbnB1dCBmb3JtcyAqL1xyXHRcdFx0JHNjb3BlLmNvbnRlbnQgID0gbnVsbDtcclx0XHR9KVxyXHRcdC5lcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMpe1xyXHRcdFx0c3dhbChcIlBvc3QgZmFpbGVkXCIsIFwiUGxlYXNlIGNvbXBsZXRlIHRoZSBmcm9tIGNvcnJlY3RseVwiLCBcImVycm9yXCIpO1xyXHRcdH0pO1xyXHJcdH07XHJcclx0LyogYXMgc2VydmVyIHRlbGxzIHRoZXJlIHdhcyBuZXcgcG9zdCwgbGV0cyByZS1sb2FkIGxpc3QgZGF0YSAqL1xyXHQkc2NvcGUucmVxdWVzdEZldGNoID0gZnVuY3Rpb24oKSB7XHJcdFx0UG9zdHNTdmMuZmV0Y2goKVxyXHRcdC5zdWNjZXNzKGZ1bmN0aW9uKHBvc3RzKXtcclx0XHRcdGNvbnNvbGUubG9nKCdQb3N0cyBoYXZlIGJlZW4gbG9hZGVkIHN1Y2Nlc3NmdWxseSBmb3IgZnJvbnQgcGFnZScpO1xyXHRcdFx0JHNjb3BlLnBvc3RzID0gcG9zdHM7XHJcdFx0fSk7XHJcdH07XHJcclx0JHNjb3BlLnJlcXVlc3RGZXRjaCgpO1xyfSk7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1Bvc3RzU3ZjJywgZnVuY3Rpb24oJGh0dHApe1xuXHR0aGlzLmZldGNoID0gZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3Bvc3RzJyk7XG5cdH07XG5cblx0dGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KXtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuXHR9O1xuXG5cdHRoaXMucmVtb3ZlID0gZnVuY3Rpb24ocG9zdCl7XG5cdFx0Y29uc29sZS5sb2coXCJkZWxldGluZyBwb3N0aW5nXCIpO1xuXHRcdGNvbnNvbGUubG9nKCdwb3N0Ll9pZDonLCBwb3N0Ll9pZCk7XG5cdFx0cmV0dXJuICRodHRwLnB1dCgnL2FwaS9wb3N0cycsIHBvc3QpO1xuXHR9O1xufSk7XG5hbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQpe1xuXHQvL3ZhciB1cmwgPSAnd3M6Ly8xOTIuMTY4LjAuNDo1MDAwJzsgLy8gZGV2ZWxvcG1ldG4gbG9jYWxseSBcblx0dmFyIHVybCA9ICd3czovL2Zyb3plbi1iYWRsYW5kcy04NjQ5Lmhlcm9rdWFwcC5jb20nOyAvLyBwcm9kdWN0aW9uXG5cdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xuXG5cdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29uZWN0aW5nLi4uJyk7XG5cdFx0JHRpbWVvdXQoY29ubmVjdCwgMTAqMTAwMDApO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24oZSl7XG5cdFx0Y29uc29sZS5sb2coZSk7XG5cdFx0dmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG5cdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3czonICsgcGF5bG9hZC50eXBlLCBwYXlsb2FkLmRhdGEpO1xuXHR9XG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHRpbWVvdXQpe1xuXHQvL3ZhciB1cmwgPSAnd3M6Ly8xOTIuMTY4LjAuNDo1MDAwJzsgLy8gZGV2ZWxvcG1ldG4gbG9jYWxseSBcblx0dmFyIHVybCA9ICd3czovL2Zyb3plbi1iYWRsYW5kcy04NjQ5Lmhlcm9rdWFwcC5jb20nOyAvLyBwcm9kdWN0aW9uXG5cdHZhciBjb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmwpO1xuXG5cdGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29uZWN0aW5nLi4uJyk7XG5cdFx0JHRpbWVvdXQoY29ubmVjdCwgMTAqMTAwMDApO1xuXHR9O1xuXG5cdGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24oZSl7XG5cdFx0Y29uc29sZS5sb2coZSk7XG5cdFx0dmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG5cdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCd3czonICsgcGF5bG9hZC50eXBlLCBwYXlsb2FkLmRhdGEpO1xuXHR9XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=